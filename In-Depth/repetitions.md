---
name: Repetitions
order: 3
---

# Repetitions

ts-macro has **repetitions** which are heavily inspired by Rust. They allow you to repeat code for every element of an array, without loops. Since ts-macros is limited by the typescript compiler, this is the syntax for repetitions:

```
+[separator?, [arrays]?, () => codeToRepeat]
```

The `separator` is an optional string which will separate all the expressions generated by the repetition. If a separator is omitted, then every expression will be an `ExpressionStatement`. 

`[arrays]` is an array of array literals. The repetition will go over every element inside the literals. If this is omitted, then the repetition will only work with **rest** parameters:

```ts --Macro
function $random(...nums: Array<number>) : Array<number> {
    return +["[]", (nums: number) => nums * Math.random() << 0] as unknown as Array<number>; // The [] separator puts everything in an array
}
```
```ts --Call
$random!(1, 2, 3);
```
```js --Result
[1 * Math.random() << 0, 2 * Math.random() << 0, 3 * Math.random() << 0]
```

and with array literals:

```ts --Macro
function $add(nums: Array<number>, ...others: Array<number>) {
   +[[nums], (numbers: number, others: number) => numbers + others];
}
```
```ts --Call
$add!([1, 2, 3], 1, 2, 3);
```
```ts --Result
2
4
6
```

## Separators

You can use the following separators:

- `[]` - Puts all the values in an array.
- `+` - Adds all the values.
- `-` - Subtracts all the values.
- `*` - Multiplies all the values.
- `()` - Creates a comma list expression from all expressions.
- `||` - Creates an OR chain with the expressions. 
- `&&` - Creates an AND chain with the expressions.

## Repetitions as function arguments

If a repetition is placed inside of a function call, and a separator is **not** provided, then all results will be passed as arguments.

```ts --Macro
function $log(...items: Array<number>) {
    console.log(+[(items: number) => items + 1]);
}
```
```ts --Call
$log!(1, 2, 3, 4, 5);
```
```ts --Result
console.log(2, 3, 4, 5, 6);
```

## $$i built-in macro

ts-docs provides a built-in macro, `$$i`, if used inside a repetition, it'll return the number of the current iteration, if it's used outside, `-1`.

```ts --Macro
import { $$i } from "../../dist";

function $arr(...els: Array<number>) : Array<number> {
    return +["[]", (els: number) => els + $$i!()] as unknown as Array<number>;
}
```
```ts --Call
$arr!(1, 2, 3);
```
```ts --Result
[1, 3, 5]
```