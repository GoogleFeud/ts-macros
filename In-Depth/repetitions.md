---
name: Repetitions
order: 3
---

# Repetitions

ts-macro has **repetitions** which are heavily inspired by Rust. They allow you to repeat code for every element of an array, without loops. Since ts-macros is limited by the typescript compiler, this is the syntax for repetitions:

```
+[separator?, () => codeToRepeat]
```

The `separator` is an optional string which will separate all the expressions generated by the repetition. If a separator is omitted, then every expression will act as an `ExpressionStatement`. 

Repetitions only work with **rest** parameters and parmeters with the `AsRest` marker (more on that later).

```ts --Macro
function $random(...nums: Array<number>) : Array<number> {
    return +["[]", (nums: number) => nums * Math.random() << 0] as unknown as Array<number>; // The [] separator puts everything in an array
}
```
```ts --Call
$random!(1, 2, 3);
```
```js --Result
[1 * Math.random() << 0, 2 * Math.random() << 0, 3 * Math.random() << 0]
```

## Separators

You can use the following separators:

- `[]` - Puts all the values in an array.
- `+` - Adds all the values.
- `-` - Subtracts all the values.
- `*` - Multiplies all the values.
- `,` - Separates all expressions with a comma.
- `||` - Creates an OR chain with the expressions. 
- `&&` - Creates an AND chain with the expressions.

## Repetitions as function arguments

If a repetition is placed inside of a function call, and a separator is **not** provided, then all results will be passed as arguments.

```ts --Macro
function $log(...items: Array<number>) {
    console.log(+[(items: number) => items + 1]);
}
```
```ts --Call
$log!(1, 2, 3, 4, 5);
```
```ts --Result
console.log(2, 3, 4, 5, 6);
```

## $$i built-in macro

ts-docs provides a built-in macro, `$$i`, if used inside a repetition, it'll return the number of the current iteration, if it's used outside, `-1`.

```ts --Macro
import { $$i } from "../../dist";

function $arr(...els: Array<number>) : Array<number> {
    return +["[]", (els: number) => els + $$i!()] as unknown as Array<number>;
}
```
```ts --Call
$arr!(1, 2, 3);
```
```ts --Result
[1, 3, 5]
```

## AsRest marker

If a parameter has the `AsRest` type, the parameter will act exactly as rest parameter. This allows you to use repetitions with multiple macro parameters.

```ts --Macro
import { AsRest } from "../../src";

function $addItems<T>(keys: AsRest<Array<string>>, values: AsRest<Array<unknown>>) : T {
    return Object.assign({}, +[(keys: string, values: unknown) => ({[keys]: values})]) as unknown as T;
}
```
```ts --Call
const obj = $addItems!<{A: number, B: number, C: number}>(["A", "B", "C"], [1, 2, 3]);
```
```ts --Result
const obj = Object.assign({}, ({ ["A"]: 1 }), ({ ["B"]: 2 }), ({ ["C"]: 3 }));
```

