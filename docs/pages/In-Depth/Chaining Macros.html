<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="keywords" content="typescript, documentation, docs, ts, ts-macros"><title>Chaining Macros | ts-macros</title><meta name="description" content="Typescript API documentation for ts-macros v1.3.6"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><link id="highlightTheme" rel="stylesheet" crossorigin="anonymous"><link rel="icon" type="image/x-icon" href="/assets/media/favicon.ico"><link href="../../assets/css/index.css" type="text/css" rel="stylesheet"><script>window.depth="../../";window.ab=false;</script><script src="../../assets/js/index.js"></script></head><body><header class="container-fluid navi"><div class="row"><div class="col-4"><input class="form-control search" id="search" type="search" placeholder="Search..." aria-label="Search"></div><div class="col-8"><div class="row float-end row-cols-auto" style="margin-top:5px"><div class="col clickable-icon" id="theme-icon"></div><div class="col"><a href="https://github.com/GoogleFeud/ts-macros/tree/HEAD" class="clickable-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-github" viewbox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a></div><div class="col"><span style="font-size: 1.2em">v1.3.6</span></div></div></div></div></header><div class="container-fluid"><div class="row"><nav class="col-lg-auto sidebar" id="sidebar"><h1 class="lib-name text-center"><a href="../../index.html">ts-macros</a></h1><p class="current-thing text-center"></p><div class="sidebar-members"><div class="sidebar-member"><div class="collapsible-trigger"><span class="collapsible-arrow open"></span><span class="sidebar-category">In-Depth</span></div><div class="collapsible-body open"><span class="sidebar-category-member"><a href="../In-Depth/Overview.html">Overview</a></span><span class="sidebar-category-member"><span><a href="../In-Depth/Chaining Macros.html" style="font-weight: bold">Chaining Macros</a><div style="padding-left:15px"><a href="#macro-resolution" class="sidebar-category-member">Macro resolution</a></div></span></span><span class="sidebar-category-member"><a href="../In-Depth/Expanding macros.html">Expanding macros</a></span><span class="sidebar-category-member"><a href="../In-Depth/Parameters.html">Parameters</a></span><span class="sidebar-category-member"><a href="../In-Depth/Repetitions.html">Repetitions</a></span><span class="sidebar-category-member"><a href="../In-Depth/Literals.html">Literals</a></span><span class="sidebar-category-member"><a href="../In-Depth/Markers.html">Markers</a></span><span class="sidebar-category-member"><a href="../In-Depth/Built-in macros.html">Built-in macros</a></span><span class="sidebar-category-member"><a href="../In-Depth/Macro labels.html">Macro labels</a></span></div></div><div class="sidebar-member"><div class="collapsible-trigger"><span class="collapsible-arrow open"></span><span class="sidebar-category">Links</span></div><div class="collapsible-body open"><span class="sidebar-category-member"><a href="https://googlefeud.github.io/ts-macros/playground/" target="_blank"><span style="position: relative; top: -2.25px; right: 3px;"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-box-arrow-up-left" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M7.364 3.5a.5.5 0 0 1 .5-.5H14.5A1.5 1.5 0 0 1 16 4.5v10a1.5 1.5 0 0 1-1.5 1.5h-10A1.5 1.5 0 0 1 3 14.5V7.864a.5.5 0 1 1 1 0V14.5a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5v-10a.5.5 0 0 0-.5-.5H7.864a.5.5 0 0 1-.5-.5z"></path><path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h5a.5.5 0 0 1 0 1H1.707l8.147 8.146a.5.5 0 0 1-.708.708L1 1.707V5.5a.5.5 0 0 1-1 0v-5z"></path></svg></span>Playground</a></span></div></div></div></nav><main id="content" class="col content"><div class="d-none" id="search-menu"><h1>Search results</h1><div class="row" style="margin-top: 20px;margin-bottom: 20px"><div class="col-md-4"><p class="mini-header">Types</p><div><input type="checkbox" class="c-checkbox" id="search-option-classes" checked><span>Classes</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-interfaces" checked><span>Interfaces</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-enums" checked><span>Enums</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-functions" checked><span>Functions</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-types" checked><span>Type aliases</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-constants"><span>Constants</span></div></div><div class="col-md-4"><p class="mini-header">Members</p><div><div><input type="checkbox" class="c-checkbox" id="search-option-properties" checked><span>Properties</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-methods" checked><span>Methods</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-getters" checked><span>Getters</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-setters" checked><span>Setters</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-enum-members"><span>Enum members</span></div><div><input type="checkbox" class="c-checkbox" id="search-option-privates"><span>Show privates</span></div></div></div><div class="col-md-4"><p class="mini-header">Other</p><div><div><input type="checkbox" class="c-checkbox" id="search-option-this-module-only"><span>In this module only</span></div></div></div></div><div id="search-result-list"></div></div><div id="content-main" class="d-none"><div class="path"><span><a href="../../index.html" class="path-member">index</a> / <span class="path-member">In-Depth</span> / <a href="" class="path-member">Chaining Macros</a></span></div><h1 id="chaining-macros" class="section-header">Chaining macros</h1><p>Macros can also be <strong>chained</strong> with any javascript expression. This doesn&#39;t sit well with the typescript compiler, so you&#39;ll have to create types for the macros yourself by creating custom types. Here&#39;s an example of a vector data type, except the inner data of the vector is completely hidden - macros are used to abstract away the underlying data source - the array. As you can see, there&#39;s no trace of the <code>Vector</code> in the compiled code.</p>
<div class="tab-code"><span class="tab-code-tab hljs">Macros</span><span class="tab-code-tab hljs">Result</span><div class="tab-code-code" style="display: none"><pre><code class="hljs"><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> Vector {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">$new</span>(<span class="hljs-params"></span>): Vector {
        <span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> Vector;
    }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Vector {
    $x(): <span class="hljs-built_in">number</span>;
    $y(): <span class="hljs-built_in">number</span>;
    $add(x?: <span class="hljs-built_in">number</span>, y?: <span class="hljs-built_in">number</span>): Vector;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">$data</span>(<span class="hljs-params">v: Vector</span>) : [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] {
    <span class="hljs-keyword">return</span> v <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">$x</span>(<span class="hljs-params">v: Vector</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> $data!(v)[<span class="hljs-number">0</span>];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">$y</span>(<span class="hljs-params">v: Vector</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> $data!(v)[<span class="hljs-number">1</span>];
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">$add</span>(<span class="hljs-params">v: Vector, x?: <span class="hljs-built_in">number</span>, y?: <span class="hljs-built_in">number</span></span>) : Vector {
    <span class="hljs-keyword">return</span> [$data!(v)[<span class="hljs-number">0</span>] + (x || <span class="hljs-number">0</span>), $data!(v)[<span class="hljs-number">1</span>] + (y || <span class="hljs-number">0</span>)] <span class="hljs-keyword">as</span> unknown <span class="hljs-keyword">as</span> Vector;
}

<span class="hljs-keyword">const</span> myVec = Vector.<span class="hljs-property">$new</span>!();
<span class="hljs-keyword">const</span> addedVec = myVec.<span class="hljs-property">$add</span>!(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(addedVec.<span class="hljs-property">$x</span>!(), addedVec.<span class="hljs-property">$y</span>!(), $asVec!([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]).<span class="hljs-property">$x</span>!());</code></pre></div><div class="tab-code-code" style="display: none"><pre><code class="hljs"><span class="hljs-keyword">const</span> myVec = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];
<span class="hljs-keyword">const</span> addedVec = [myVec[<span class="hljs-number">0</span>] + (<span class="hljs-number">1</span>), myVec[<span class="hljs-number">1</span>] + (<span class="hljs-number">2</span>)];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(addedVec[<span class="hljs-number">0</span>], addedVec[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>);</code></pre></div></div><h2 id="macro-resolution" class="section-header">Macro resolution</h2><p>The ts-macros transformer keeps tracks of macros using their unique <strong>symbol</strong>. Since you must declare the type for the macros yourself (see the <code>Vector</code> example above), the macro function declaration and the type declaration do not share a symbol, so the transformer needs another way to see which macro you&#39;re really trying to call. </p>
<p>This is why the transformer compares the types of the parameters from the macro call site to all macros of the same name. For example:</p>
<pre><code class="hljs"><span class="hljs-comment">// In file A</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">$create</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) { ... }
<span class="hljs-comment">// In file B</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">$create</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span>, createdAt: <span class="hljs-built_in">number</span></span>) { ... }</code></pre><p>These two macros are perfectly fine, it&#39;s ok that they&#39;re sharing a name, the transformer can still differenciate them when they&#39;re used like this:</p>
<pre><code class="hljs"><span class="hljs-keyword">import</span> { $create } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./A&quot;</span>;
<span class="hljs-keyword">import</span> { $create <span class="hljs-keyword">as</span> $create2 } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./B&quot;</span>;

$create!(<span class="hljs-string">&quot;Google&quot;</span>, <span class="hljs-number">44</span>); <span class="hljs-comment">// Valid</span>
$create2!(<span class="hljs-string">&quot;123&quot;</span>, Date.<span class="hljs-title function_">now</span>()) <span class="hljs-comment">// Valid</span></code></pre><p><strong>However</strong>, when either of the macros get used in chaining, the transformer is going to raise an error, because both macros have the exact same parameter types, in the exact same order - <code>string</code>, <code>number</code>.</p>
<p>The only ways to fix this are to either:</p>
<ul>
<li>Rename one of the macros</li>
<li>Switch the order of the parameters</li>
</ul>
</div></main></div></div><div id="to-top" class="btn-to-top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-up" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"></path></svg></div><div id="sidebar-arrow" class="sidebar-arrow"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-right" viewbox="0 0 16 16"><path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"></path></svg></div></body></html>