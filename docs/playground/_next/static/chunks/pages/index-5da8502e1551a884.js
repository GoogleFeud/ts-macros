(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{4965:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.labelActions=t.unaryActions=t.binaryActions=t.binaryNumberActions=void 0;const n=r(4625),i=r(7914);t.binaryNumberActions={[n.SyntaxKind.MinusToken]:(e,t)=>n.factory.createNumericLiteral(e+t),[n.SyntaxKind.AsteriskToken]:(e,t)=>n.factory.createNumericLiteral(e*t),[n.SyntaxKind.SlashToken]:(e,t)=>n.factory.createNumericLiteral(e/t),[n.SyntaxKind.LessThanToken]:(e,t)=>e<t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.LessThanEqualsToken]:(e,t)=>e<=t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.GreaterThanToken]:(e,t)=>e>t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.GreaterThanEqualsToken]:(e,t)=>e>=t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.AmpersandToken]:(e,t)=>n.factory.createNumericLiteral(e&t),[n.SyntaxKind.BarToken]:(e,t)=>n.factory.createNumericLiteral(e|t),[n.SyntaxKind.CaretToken]:(e,t)=>n.factory.createNumericLiteral(e^t),[n.SyntaxKind.PercentToken]:(e,t)=>n.factory.createNumericLiteral(e%t)},t.binaryActions={[n.SyntaxKind.PlusToken]:(e,t,r,i)=>"string"===typeof r||"string"===typeof i?n.factory.createStringLiteral(r+i):"number"===typeof r||"number"===typeof i?n.factory.createNumericLiteral(r+i):void 0,[n.SyntaxKind.EqualsEqualsEqualsToken]:(e,t,r,i)=>r===i?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.EqualsEqualsToken]:(e,t,r,i)=>r==i?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.ExclamationEqualsEqualsToken]:(e,t,r,i)=>r!==i?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.ExclamationEqualsToken]:(e,t,r,i)=>r!=i?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.AmpersandAmpersandToken]:(e,t,r,n)=>r&&n?t:r?n?void 0:t:e,[n.SyntaxKind.BarBarToken]:(e,t,r,n)=>r?e:t},t.unaryActions={[n.SyntaxKind.ExclamationToken]:e=>e?n.factory.createFalse():n.factory.createTrue(),[n.SyntaxKind.MinusToken]:e=>{if("number"===typeof e)return n.factory.createNumericLiteral(-e)},[n.SyntaxKind.TildeToken]:e=>{if("number"===typeof e)return n.factory.createNumericLiteral(~e)},[n.SyntaxKind.PlusToken]:e=>{if("number"===typeof e||"string"===typeof e)return n.factory.createNumericLiteral(+e)}},t.labelActions={[n.SyntaxKind.IfStatement]:e=>(0,i.createObject)({kind:n.factory.createNumericLiteral(0),condition:e.expression,then:e.thenStatement,else:e.elseStatement}),[n.SyntaxKind.ForOfStatement]:e=>{let t;if(n.isVariableDeclarationList(e.initializer)){const r=e.initializer.declarations[0];r&&n.isIdentifier(r.name)&&(t=r.name)}else t=e.initializer;return(0,i.createObject)({kind:n.factory.createNumericLiteral(1),type:n.factory.createStringLiteral("of"),initializer:t,iterator:e.expression,statement:e.statement})},[n.SyntaxKind.ForInStatement]:e=>{let t;if(n.isVariableDeclarationList(e.initializer)){const r=e.initializer.declarations[0];r&&n.isIdentifier(r.name)&&(t=r.name)}else t=e.initializer;return(0,i.createObject)({kind:n.factory.createNumericLiteral(1),type:n.factory.createStringLiteral("in"),initializer:t,iterator:e.expression,statement:e.statement})},[n.SyntaxKind.WhileStatement]:e=>(0,i.createObject)({kind:n.factory.createNumericLiteral(3),do:n.factory.createFalse(),condition:e.expression,statement:e.statement}),[n.SyntaxKind.DoStatement]:e=>(0,i.createObject)({kind:n.factory.createNumericLiteral(3),do:n.factory.createTrue(),condition:e.expression,statement:e.statement}),[n.SyntaxKind.ForStatement]:e=>{let t,r;if(e.initializer)if(n.isVariableDeclarationList(e.initializer)){t=[];for(const r of e.initializer.declarations)n.isIdentifier(r.name)&&t.push(n.factory.createArrayLiteralExpression([n.factory.createIdentifier(r.name.text),r.initializer||n.factory.createIdentifier("undefined")]))}else r=e.initializer;return(0,i.createObject)({kind:n.factory.createNumericLiteral(2),initializer:(0,i.createObject)({variables:t&&n.factory.createArrayLiteralExpression(t),expression:r}),condition:e.condition,increment:e.incrementor,statement:e.statement})},[n.SyntaxKind.Block]:e=>(0,i.createObject)({kind:n.factory.createNumericLiteral(4),statement:e})}},3349:function(e,t,r){"use strict";t.wN=void 0;const n=r(249);t.wN=new Map,t.ZP=(e,r)=>i=>{const a=e.getTypeChecker(),o=new n.MacroTransformer(i,a,t.wN,r);return e=>o.run(e)}},5780:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4625),i=r(9939),a=r(175),o=r(7914),s={},c={};t.default={$$loadEnv:{call:(e,t,i)=>{const s=e.length&&n.isStringLiteral(e[0])?e[0].text:"";let c;try{c=r(Object(function(){var e=new Error("Cannot find module 'dotenv'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(l){throw(0,o.MacroError)(i,"`loadEnv` macro called but `dotenv` module is not installed.")}return s?c.config({path:a.join(n.sys.getCurrentDirectory(),s)}):c.config(),t.props.optimizeEnv=!0,t.context.factory.createCallExpression(t.context.factory.createPropertyAccessExpression(t.context.factory.createCallExpression(t.context.factory.createIdentifier("require"),void 0,[t.context.factory.createStringLiteral("dotenv")]),t.context.factory.createIdentifier("config")),void 0,s?[t.context.factory.createObjectLiteralExpression([t.context.factory.createPropertyAssignment(t.context.factory.createIdentifier("path"),t.context.factory.createStringLiteral(s))])]:[])}},$$readFile:{call:([e,t],r,a)=>{const l=e&&r.getStringFromNode(e,!1,!0);if(!l)throw(0,o.MacroError)(a,"`readFile` macro expects a path to the JSON file as the first parameter.");const u=t&&r.getBoolFromNode(t);if(u){if(s[l])return s[l]}else if(c[l])return c[l];const d=i.readFileSync(l,"utf-8");if(u){const e=(0,o.primitiveToNode)(JSON.parse(d));return s[l]=e,e}return c[l]=d,n.factory.createStringLiteral(d)}},$$inline:{call:([e,t,r],i,a)=>{if(!e)throw(0,o.MacroError)(a,"`inline` macro expects a function as the first argument.");if(!t||!n.isArrayLiteralExpression(t))throw(0,o.MacroError)(a,"`inline` macro expects an array of expressions as the second argument.");const s=(0,o.normalizeFunctionNode)(i.checker,n.visitNode(e,i.boundVisitor));if(!s||!s.body)throw(0,o.MacroError)(a,"`inline` macro expects a function as the first argument.");let c;if(s.parameters.length){const e=new Map;for(let i=0;i<s.parameters.length;i++){const r=s.parameters[i];n.isIdentifier(r.name)&&e.set(r.name.text,t.elements[i])}const r=t=>n.isIdentifier(t)&&e.has(t.text)?e.get(t.text):n.visitEachChild(t,r,i.context);i.context.suspendLexicalEnvironment(),c=n.visitFunctionBody(s.body,r,i.context)}else c=s.body;return r?n.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,c):n.isBlock(c)?c.statements:c}},$$inlineFunc:{call:(e,t,r)=>{const i=[...e].reverse(),a=i.pop();if(!a)throw(0,o.MacroError)(r,"`inlineFunc` macro expects an arrow function as the first argument.");const s=n.visitNode(a,t.boundVisitor);if(!s||!n.isArrowFunction(s))throw(0,o.MacroError)(r,"`inlineFunc` macro expects an arrow function as the first argument.");if(!s.parameters.length)return n.isBlock(s.body)?s.body.statements:s.body;const c=new Map;for(const o of s.parameters)n.isIdentifier(o.name)&&c.set(o.name.text,i.pop());const l=e=>n.isIdentifier(e)&&c.has(e.text)?c.get(e.text):n.visitEachChild(e,l,t.context);t.context.suspendLexicalEnvironment();const u=n.visitFunctionBody(s.body,l,t.context);return n.isBlock(u)&&u.statements,u}},$$kindof:{call:(e,t,r)=>{if(!e.length)throw(0,o.MacroError)(r,"`kindof` macro expects a single argument.");return t.context.factory.createNumericLiteral(e[0].kind)}},$$define:{call:([e,t,r],i,a)=>{const s=i.getStringFromNode(e,!0,!0);if("string"!==typeof s)throw(0,o.MacroError)(a,"`define` macro expects a string literal as the first argument.");const c=i.context.factory.createVariableDeclarationList([i.context.factory.createVariableDeclaration(s,void 0,void 0,t)],r?n.NodeFlags.Let:n.NodeFlags.Const);return n.isForStatement(a.parent)?c:[n.factory.createVariableStatement(void 0,c)]}},$$i:{call:(e,t)=>t.repeat.length?t.context.factory.createNumericLiteral(t.repeat[t.repeat.length-1].index):t.context.factory.createNumericLiteral(-1)},$$length:{call:([e],t,r)=>{if(!e)throw(0,o.MacroError)(r,"`length` macro expects an array / string literal as the first argument.");if(n.isArrayLiteralExpression(e))return t.context.factory.createNumericLiteral(e.elements.length);const i=t.getStringFromNode(e,!0,!0);if(i)return t.context.factory.createNumericLiteral(i.length);throw(0,o.MacroError)(r,"`length` macro expects an array / string literal as the first argument.")}},$$ident:{call:([e],t,r)=>{var i,a;if(!e)throw(0,o.MacroError)(r,"`ident` macro expects a string literal as the first parameter.");const s=t.getStringFromNode(e,!0,!0);return s?(null===(a=null===(i=t.getLastMacro())||void 0===i?void 0:i.defined)||void 0===a?void 0:a.get(s))||n.factory.createIdentifier(s):e}},$$err:{call:([e],t,r)=>{const n=t.getStringFromNode(e,!1,!0);if(!n)throw(0,o.MacroError)(r,"`err` macro expects a string literal as the first argument.");const i=t.macroStack.pop();throw(0,o.MacroError)(r,`${i?`In macro ${i.macro.name}: `:""}${n}`)}},$$includes:{call:([e,t],r,i)=>{if(!e)throw(0,o.MacroError)(i,"`includes` macro expects an array/string literal as the first argument.");if(!t)throw(0,o.MacroError)(i,"`includes` macro expects a second argument.");const a=r.getStringFromNode(e,!1,!0);if(a){const e=r.getLiteralFromNode(t);if("string"!==typeof e)throw(0,o.MacroError)(i,"`includes` macro expects a string literal as the second argument.");return a.includes(e)?n.factory.createTrue():n.factory.createFalse()}if(n.isArrayLiteralExpression(e)){return e.elements.map((e=>r.getLiteralFromNode(n.visitNode(e,r.boundVisitor)))).includes(r.getLiteralFromNode(t))?n.factory.createTrue():n.factory.createFalse()}throw(0,o.MacroError)(i,"`includes` macro expects an array/string literal as the first argument.")}},$$ts:{call:([e],t,r)=>{const i=t.getStringFromNode(n.visitNode(e,t.boundVisitor),!0,!0);if(!i)throw(0,o.MacroError)(r,"`ts` macro expects a string as it's first argument.");const a=n.createSourceFile("expr",i,n.ScriptTarget.ESNext,!1,n.ScriptKind.JS),s=e=>n.isIdentifier(e)?n.factory.createIdentifier(e.text):n.visitEachChild(e,s,t.context);return n.visitNodes(a.statements,s)}},$$escape:{call:([e],t,r)=>{if(!e)throw(0,o.MacroError)(r,"`escape` macro expects a function as it's first argument.");const i=(0,o.normalizeFunctionNode)(t.checker,n.visitNode(e,t.boundVisitor));if(!i||!i.body)throw(0,o.MacroError)(r,"`escape` macro expects a function as it's first argument.");if(!n.isBlock(i.body))return i.body;{const e=[...t.makeHygienic(i.body.statements)],r=e.pop();if(t.escapeStatement(...e),r){if(n.isReturnStatement(r))return r.expression;if(!e.length)return r;t.escapeStatement(r)}}}},$$slice:{call:([e,t,r],i,a)=>{if(!e)throw(0,o.MacroError)(a,"`slice` macro expects an array/string literal as the first argument.");const s=t&&i.getNumberFromNode(t)||-1/0,c=r&&i.getNumberFromNode(r)||1/0,l=i.getStringFromNode(e,!1,!0);if(l)return n.factory.createStringLiteral(l.slice(s,c));if(n.isArrayLiteralExpression(e))return n.factory.createArrayLiteralExpression(e.elements.slice(s,c));throw(0,o.MacroError)(a,"`includes` macro expects an array/string literal as the first argument.")}},$$propsOfType:{call:(e,t,r)=>{if(!r.typeArguments||!r.typeArguments[0])throw(0,o.MacroError)(r,"`propsOfType` macro expects one type parameter.");const i=t.checker.getTypeAtLocation(r.typeArguments[0]);if(i.isTypeParameter()){const e=t.getTypeParam(i);return e?n.factory.createArrayLiteralExpression(e.getProperties().map((e=>n.factory.createStringLiteral(e.name)))):n.factory.createArrayLiteralExpression()}{const e=t.getLastMacro();if(e){const r=e.macro.typeParams.map((e=>t.checker.getTypeAtLocation(e))),a=(0,o.resolveTypeArguments)(t.checker,e.call);return n.factory.createArrayLiteralExpression((0,o.resolveTypeWithTypeParams)(i,r,a).getProperties().map((e=>n.factory.createStringLiteral(e.name))))}return n.factory.createArrayLiteralExpression(i.getProperties().map((e=>n.factory.createStringLiteral(e.name))))}}},$$typeToString:{call:([e,t],r,i)=>{if(!i.typeArguments||!i.typeArguments[0])throw(0,o.MacroError)(i,"`typeToString` macro expects one type parameter.");const a=n=>(r.getBoolFromNode(e)&&(n=r.checker.getApparentType(n)),r.getBoolFromNode(t)&&(n=r.checker.getNonNullableType(n)),n),s=r.checker.getTypeAtLocation(i.typeArguments[0]);if(s.isTypeParameter()){const e=r.getTypeParam(s);return e?n.factory.createStringLiteral(r.checker.typeToString(a(e))):n.factory.createStringLiteral("")}{const e=r.getLastMacro();if(e){const t=e.macro.typeParams.map((e=>r.checker.getTypeAtLocation(e))),i=(0,o.resolveTypeArguments)(r.checker,e.call);return n.factory.createStringLiteral(r.checker.typeToString(a((0,o.resolveTypeWithTypeParams)(s,t,i))))}return n.factory.createStringLiteral(r.checker.typeToString(a(s)))}}},$$comptime:{call:([e],t,r)=>{if(t.config.noComptime)return;if(t.macroStack.length)throw(0,o.MacroError)(r,"`comptime` macro cannot be called inside macros.");if(!e)throw(0,o.MacroError)(r,"`comptime` macro expects a function as the first parameter.");const i=(0,o.normalizeFunctionNode)(t.checker,e);if(!i||!i.body)throw(0,o.MacroError)(r,"`comptime` macro expects a function as the first parameter.");let a=r.parent;if(n.isExpressionStatement(a)&&(a=a.parent,n.isBlock(a)&&(a=a.parent),"body"in a)){const e=t.checker.getSignatureFromDeclaration(a);if(!e||!e.declaration)return;t.addComptimeSignature(e.declaration,(0,o.fnBodyToString)(t.checker,i),e.parameters.map((e=>e.name)))}else;},preserveParams:!0},$$raw:{call:([e],t,r)=>{if(t.config.noComptime)return;const i=t.getLastMacro();if(!i)throw(0,o.MacroError)(r,"`raw` macro must be called inside another macro.");if(!e)throw(0,o.MacroError)(r,"`raw` macro expects a function as the first parameter.");const a=(0,o.normalizeFunctionNode)(t.checker,e);if(!a||!a.body)throw(0,o.MacroError)(r,"`raw` macro expects a function as the first parameter.");const s=[];for(const l of a.parameters.slice(1)){if(!n.isIdentifier(l.name))throw(0,o.MacroError)(r,"`raw` macro parameters cannot be deconstructors.");s.push(l.name.text)}const c=t.addComptimeSignature(a,(0,o.fnBodyToString)(t.checker,a),["ctx",...s]);return(0,o.tryRun)(c,[{ts:n,factory:n.factory,transformer:t,checker:t.checker,thisMacro:i,error:(e,t)=>{throw(0,o.MacroError)(e,t)}},...(0,o.macroParamsToArray)(i.macro.params,[...i.args])],`$$raw in ${i.macro.name}: `)},preserveParams:!0},$$setStore:{call:([e,t],r,i)=>{if(!n.isStringLiteral(e))throw(0,o.MacroError)(i,"`setStore` macro expects a string literal as the key.");const a=r.getLastMacro();if(!a)throw(0,o.MacroError)(i,"`setStore` macro must be called inside another macro.");a.store[e.text]=t}},$$getStore:{call:([e],t,r)=>{if(!n.isStringLiteral(e))throw(0,o.MacroError)(r,"`getStore` macro expects a string literal as the key.");const i=t.getLastMacro();if(!i)throw(0,o.MacroError)(r,"`getStore` macro must be called inside another macro.");return i.store[e.text]}}}},249:function(e,t,r){"use strict";var n=r(4250);Object.defineProperty(t,"__esModule",{value:!0}),t.MacroTransformer=t.NO_LIT_FOUND=void 0;const i=r(4625),a=r(5780),o=r(7914),s=r(4965);t.NO_LIT_FOUND=Symbol("NO_LIT_FOUND");t.MacroTransformer=class{constructor(e,t,r,n){this.context=e,this.boundVisitor=this.visitor.bind(this),this.repeat=[],this.macroStack=[],this.escapedStatements=[],this.props={},this.checker=t,this.macros=r,this.comptimeSignatures=new Map,this.config=n||{}}run(e){if(e.isDeclarationFile)return e;const t=[];this.addEscapeScope();for(const r of e.statements){const e=this.visitor(r);this.saveAndClearEscapedStatements(t),e&&(Array.isArray(e)?t.push(...e):t.push(e))}return this.removeEscapeScope(),i.factory.updateSourceFile(e,t)}visitor(e){var r,a,c,l,u;if(!i.isFunctionDeclaration(e)||!e.name||(null===(r=e.modifiers)||void 0===r?void 0:r.some((e=>e.kind===i.SyntaxKind.DeclareKeyword)))||!e.name.getText().startsWith("$")){if(i.isBlock(e)){const t=[];this.addEscapeScope();for(const r of e.statements){const e=this.visitor(r);this.saveAndClearEscapedStatements(t),e&&(Array.isArray(e)?t.push(...e):t.push(e))}return this.removeEscapeScope(),i.factory.updateBlock(e,t)}if(i.isLabeledStatement(e)){const t=this.findMacroByName(e.label,e.label.text);if(!t||!t.body)return;let r=e.statement;const n=[];if(i.isLabeledStatement(r)){const t=this.visitor(e.statement);if(!t)return e;if(Array.isArray(t)){const i=t.findIndex((e=>s.labelActions[e.kind]));if(-1===i)return e;n.push(...t.filter(((e,t)=>t!==i))),r=t[i]}else r=i.visitNode(e.statement,this.boundVisitor)}const a=s.labelActions[r.kind];if(!a)return e;this.macroStack.push({macro:t,call:void 0,args:i.factory.createNodeArray([a(r)]),defined:new Map,store:{}}),n.push(...i.visitEachChild(t.body,this.boundVisitor,this.context).statements);const o=t.params.find((e=>1===e.marker));return o&&(o.defaultVal=i.factory.createNumericLiteral(+o.defaultVal.text+1)),this.macroStack.pop(),n}if(i.isExpressionStatement(e)&&i.isCallExpression(e.expression)&&i.isNonNullExpression(e.expression.expression)&&i.isNonNullExpression(e.expression.expression)){const t=this.runMacro(e.expression,e.expression.expression.expression);if(!t)return;const r=this.makeHygienic(i.factory.createNodeArray(t));if(!(r.length&&i.isReturnStatement(r[r.length-1])&&i.isSourceFile(e.parent)))return r;{const e=r.pop();e.expression&&r.push(i.factory.createExpressionStatement(e.expression))}}if(i.canHaveDecorators(e)&&(null===(a=i.getDecorators(e))||void 0===a?void 0:a.length)){const t=i.getDecorators(e);let r;const n=[];for(let e=t.length-1;e>=0;e--){const a=t[e];if(i.isCallExpression(a.expression)&&i.isNonNullExpression(a.expression.expression)){const e=this.runMacro(a.expression,a.expression.expression.expression,r||a.parent);if(e&&e.length){const[t,a]=(0,o.deExpandMacroResults)(e);a&&(r=i.visitNode(a,this.boundVisitor)),n.push(...t)}}}return[...n,r]}if(i.isCallExpression(e)){if(i.isNonNullExpression(e.expression)){const t=this.runMacro(e,e.expression.expression);if(!t||!t.length)return i.factory.createNull();let r=t.pop();if(0===t.length){if(i.isReturnStatement(r)||i.isExpressionStatement(r))return r.expression;if(!(0,o.isStatement)(r))return r}return i.isExpressionStatement(r)?r=i.factory.createReturnStatement(r.expression):(0,o.isStatement)(r)||(r=i.factory.createReturnStatement(r)),i.factory.createCallExpression(i.factory.createParenthesizedExpression(i.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,i.factory.createBlock([...t,r],!0))),void 0,void 0)}this.callComptimeFunction(e)}if(i.isNewExpression(e)&&this.callComptimeFunction(e),this.macroStack.length){const{macro:r,args:a,store:d}=this.getLastMacro();if(i.isPropertyAccessExpression(e)||i.isElementAccessExpression(e)){if(i.isPropertyAccessExpression(e)&&this.props.optimizeEnv&&"process.env"===e.expression.getText()){const t=n.env[e.name.text];return t?i.factory.createStringLiteral(t):e}{let t=i.visitNode(e.expression,this.boundVisitor);for(;i.isParenthesizedExpression(t);)t=t.expression;if(i.isObjectLiteralExpression(t)){const r=i.isPropertyAccessExpression(e)?(0,o.getNameFromProperty)(e.name):this.getNumberFromNode(i.visitNode(e.argumentExpression,this.boundVisitor));if(!r)return e;const n=t.properties.find((e=>e.name&&(0,o.getNameFromProperty)(e.name)===r));return n&&i.isPropertyAssignment(n)?n.initializer:i.factory.createPropertyAccessExpression(t,r.toString())}if(i.isArrayLiteralExpression(t)){if(!i.isElementAccessExpression(e))return i.factory.createPropertyAccessExpression(t,e.name);const r=i.visitNode(e.argumentExpression,this.boundVisitor),n=this.getNumberFromNode(r);return void 0!==n&&t.elements[n]?t.elements[n]:i.factory.createElementAccessExpression(t,r)}}}else{if(i.isAsExpression(e))return i.visitNode(e.expression,this.boundVisitor);if(i.isNonNullExpression(e))return i.visitNode(e.expression,this.boundVisitor);if(i.isNumericLiteral(e))return i.factory.createNumericLiteral(e.text);if(i.isStringLiteral(e))return i.factory.createStringLiteral(e.text);if(i.isRegularExpressionLiteral(e))return i.factory.createRegularExpressionLiteral(e.text);if(i.isTemplateHead(e))return i.factory.createTemplateHead(e.text,e.rawText,e.templateFlags);if(i.isTemplateMiddle(e))return i.factory.createTemplateMiddle(e.text,e.rawText,e.templateFlags);if(i.isTemplateTail(e))return i.factory.createTemplateTail(e.text,e.rawText,e.templateFlags);if(i.isIdentifier(e)){if(d[e.text])return d[e.text];const t=this.getMacroParam(e.text,r,a);return t?i.isStringLiteral(t)&&(i.isClassDeclaration(e.parent)||i.isEnumDeclaration(e.parent)||i.isFunctionDeclaration(e.parent))?i.factory.createIdentifier(t.text):i.isIdentifier(t)?t:i.visitNode(t,this.boundVisitor):e}if(i.isVariableStatement(e)){const t=[];for(const r of e.declarationList.declarations)i.isIdentifier(r.name)&&r.name.text.startsWith("$")?d[r.name.text]=i.visitNode(r.initializer,this.boundVisitor)||i.factory.createIdentifier("undefined"):t.push(i.visitNode(r,this.boundVisitor));return t.length?i.factory.createVariableStatement(e.modifiers,i.factory.createVariableDeclarationList(t,e.declarationList.flags)):void 0}if(i.isArrayLiteralExpression(e)&&e.elements.some((e=>i.isSpreadElement(e)))){const t=[];for(const r of e.elements)if(i.isSpreadElement(r)){const e=i.visitNode(r.expression,this.boundVisitor);i.isArrayLiteralExpression(e)?t.push(...e.elements):t.push(i.visitNode(r,this.boundVisitor))}else t.push(i.visitNode(r,this.boundVisitor));return i.factory.createArrayLiteralExpression(t)}if(i.isConditionalExpression(e)){const t=i.visitNode(e.condition,this.boundVisitor),r=this.getBoolFromNode(t);return!1===r?i.visitNode(e.whenFalse,this.boundVisitor):!0===r?i.visitNode(e.whenTrue,this.boundVisitor):i.factory.createConditionalExpression(t,void 0,i.visitNode(e.whenTrue,this.boundVisitor),void 0,i.visitNode(e.whenFalse,this.boundVisitor))}if(i.isIfStatement(e)&&!i.isParenthesizedExpression(e.expression)){const t=i.visitNode(e.expression,this.boundVisitor),r=this.getBoolFromNode(t);if(!0===r){const t=i.visitNode(e.thenStatement,this.boundVisitor);return t&&i.isBlock(t)?[...t.statements]:t}if(!1===r){if(!e.elseStatement)return;const t=i.visitNode(e.elseStatement,this.boundVisitor);return t&&i.isBlock(t)?[...t.statements]:t}return i.factory.createIfStatement(t,i.visitNode(e.thenStatement,this.boundVisitor),i.visitNode(e.elseStatement,this.boundVisitor))}if(i.isBinaryExpression(e)){const r=e.operatorToken.kind,n=i.visitNode(e.left,this.boundVisitor),a=i.visitNode(e.right,this.boundVisitor),o=this.getLiteralFromNode(n),u=this.getLiteralFromNode(a);return o===t.NO_LIT_FOUND||u===t.NO_LIT_FOUND?i.factory.createBinaryExpression(n,r,a):s.binaryNumberActions[r]&&"number"===typeof o&&"number"===typeof u?s.binaryNumberActions[r](o,u):null!==(l=null===(c=s.binaryActions[r])||void 0===c?void 0:c.call(s.binaryActions,n,a,o,u))&&void 0!==l?l:i.factory.createBinaryExpression(n,r,a)}if(i.isTypeOfExpression(e)){const r=i.visitNode(e.expression,this.boundVisitor),n=this.getLiteralFromNode(r);return n===t.NO_LIT_FOUND?r:i.factory.createStringLiteral(typeof n)}if(i.isExpressionStatement(e)&&i.isPrefixUnaryExpression(e.expression)&&39===e.expression.operator&&i.isArrayLiteralExpression(e.expression.operand)){const{separator:t,function:n,literals:i}=(0,o.getRepetitionParams)(e.expression.operand);return this.execRepetition(n,a,r,i,t)}if(i.isPrefixUnaryExpression(e)){if(39===e.operator&&i.isArrayLiteralExpression(e.operand)){const{separator:t,function:n,literals:i}=(0,o.getRepetitionParams)(e.operand);if(!t)throw(0,o.MacroError)(e,"Repetition separator must be included if a repetition is used as an expression.");return this.execRepetition(n,a,r,i,t,!0)}{const r=e.operator,n=i.visitNode(e.operand,this.boundVisitor),a=this.getLiteralFromNode(n);return a===t.NO_LIT_FOUND?e:(null===(u=s.unaryActions[r])||void 0===u?void 0:u.call(s.unaryActions,a))||n}}if(i.isCallExpression(e)){const t=e.arguments.findIndex((e=>i.isPrefixUnaryExpression(e)&&39===e.operator&&i.isArrayLiteralExpression(e.operand)));if(-1!==t){const n=e.arguments[t].operand,{separator:s,function:c,literals:l}=(0,o.getRepetitionParams)(n);if(!s){const n=this.execRepetition(c,a,r,l,s,!0),o=[];for(let r=0;r<e.arguments.length;r++)r===t?o.push(...n):o.push(e.arguments[r]);return i.visitNode(i.factory.createCallExpression(e.expression,e.typeArguments,o),this.boundVisitor)}}}}return i.visitEachChild(e,this.boundVisitor,this.context)}return i.visitEachChild(e,this.boundVisitor,this.context)}{if(!e.body)return e;const t=this.checker.getSymbolAtLocation(e.name);if(!t)return e;if(this.macros.has(t))return;const r=t.name,n=[];for(let a=0;a<e.parameters.length;a++){const t=e.parameters[a];if(!i.isIdentifier(t.name))throw(0,o.MacroError)(t,"You cannot use deconstruction patterns in macros.");const r=this.getMarker(t);n.push({spread:Boolean(t.dotDotDotToken),marker:r,start:a,name:t.name.text,defaultVal:t.initializer||(t.questionToken?i.factory.createIdentifier("undefined"):void 0)})}this.macros.set(t,{name:r,params:n,body:e.body,typeParams:e.typeParameters||[]})}}execRepetition(e,t,r,n,a,s){const l=[],u=e.parameters.map((e=>e.name.getText())),d=Array.from({length:u.length},(()=>[]));for(let o=0;o<n.length;o++){const e=n[o],t=i.visitNode(e,this.boundVisitor);i.isArrayLiteralExpression(t)&&d[o%u.length].push(...t.elements)}const p=this.repeat.push({index:0,elementSlices:d,repeatNames:u})-1,f=Math.max(...d.map((e=>e.length)));for(;this.repeat[p].index<f;this.repeat[p].index++)if("statements"in e.body)if(s)l.push((0,o.wrapExpressions)(e.body.statements.map((e=>i.visitNode(e,this.boundVisitor)))));else for(const t of e.body.statements){const e=this.boundVisitor(t);e&&(Array.isArray(e)?l.push(...e):l.push(e))}else{const t=i.visitNode(e.body,this.boundVisitor);l.push(t)}return this.repeat.pop(),a&&c[a]?[c[a](this,l)]:l}getMacroParam(e,t,r){const n=t.params.findIndex((t=>t.name===e));if(-1===n){for(const t of this.repeat){const r=t.repeatNames.indexOf(e);if(-1!==r){const e=t.elementSlices[r];return e.length<=t.index?i.factory.createNull():e[t.index]}}return}const a=t.params[n];if(a.realName)return a.realName;if(a.spread){const e=r.slice(a.start);return 1===e.length&&i.isSpreadElement(e[0])?e[0].expression:i.factory.createArrayLiteralExpression(r.slice(a.start))}return r[a.start]||a.defaultVal}runMacro(e,t,r){var n;const s=e.arguments;let c,l;if(i.isPropertyAccessExpression(t)){const r=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t.expression));if(r&&0!==(r.flags&i.SymbolFlags.Namespace))return this.runMacro(e,t.name);const n=this.findMacroByTypeParams(t,e);if(!n.length)throw(0,o.MacroError)(e,`No possible candidates for "${t.name.getText()}" call`);if(n.length>1)throw(0,o.MacroError)(e,`More than one possible candidate for "${t.name.getText()}" call`);c=n[0];const a=i.factory.createNodeArray([i.visitNode(t.expression,this.boundVisitor),...e.arguments]);l=this.macroStack.length?i.visitNodes(a,this.boundVisitor):a}else{const r=a.default[t.getText()];if(r){const t=r.call(r.preserveParams?s:i.visitNodes(s,this.boundVisitor),this,e);if(!t)return;return Array.isArray(t)?t:[i.factory.createExpressionStatement(t)]}c=this.macros.get((0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t))),l=this.macroStack.length?i.visitNodes(s,this.boundVisitor):s}if(!c||!c.body){const i=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t));return(null===(n=null===i||void 0===i?void 0:i.declarations)||void 0===n?void 0:n.length)?(this.boundVisitor(i.declarations[0]),this.runMacro(e,t,r)):void 0}this.macroStack.push({macro:c,args:l,call:e,target:r,defined:new Map,store:{}});const u=[];for(let a=0;a<c.params.length;a++){const e=c.params[a];if(2===e.marker){const t=e.spread?i.factory.createArrayLiteralExpression(l.slice(e.start)):l[e.start]||e.defaultVal;i.isIdentifier(t)||(e.realName=i.factory.createUniqueName(e.name),u.push(i.factory.createVariableDeclaration(e.realName,void 0,void 0,t)))}}u.length&&this.escapeStatement(i.factory.createVariableStatement(void 0,i.factory.createVariableDeclarationList(u,i.NodeFlags.Let)));const d=i.visitEachChild(c.body,this.boundVisitor,this.context).statements,p=c.params.find((e=>1===e.marker));return p&&(p.defaultVal=i.factory.createNumericLiteral(+p.defaultVal.text+1)),this.macroStack.pop(),[...d]}makeHygienic(e){var t;const r=(null===(t=this.getLastMacro())||void 0===t?void 0:t.defined)||new Map,n=e=>{if(i.isIdentifier(e)){const t=i.factory.createUniqueName(e.text);return r.set(e.text,t),t}return i.isArrayBindingPattern(e)?i.factory.createArrayBindingPattern(e.elements.map((e=>i.isBindingElement(e)?i.factory.createBindingElement(e.dotDotDotToken,e.propertyName,n(e.name),i.visitNode(e.initializer,a)):e))):i.isObjectBindingPattern(e)?i.factory.createObjectBindingPattern(e.elements.map((e=>i.factory.createBindingElement(e.dotDotDotToken,e.propertyName,n(e.name),i.visitNode(e.initializer,a))))):e},a=e=>i.isVariableDeclaration(e)&&-1!==e.pos?i.factory.updateVariableDeclaration(e,n(e.name),void 0,void 0,i.visitNode(e.initializer,a)):i.isIdentifier(e)?e.parent&&i.isPropertyAccessExpression(e.parent)&&e.parent.expression!==e?e:r.get(e.text)||e:i.visitEachChild(e,a,this.context);return i.visitNodes(i.factory.createNodeArray(e),a)}getMarker(e){if(!e.type)return 0;const t=this.checker.getTypeAtLocation(e.type).getProperty("__marker");if(!t)return 0;const r=this.checker.getTypeOfSymbol(t).getNonNullableType();if(!r.isStringLiteral())return 0;switch(r.value){case"Accumulator":return 1;case"Save":return 2;default:return 0}}callComptimeFunction(e){var r;if(this.comptimeSignatures.size){const n=this.checker.getResolvedSignature(e);if(n&&n.declaration){const i=this.comptimeSignatures.get(n.declaration);i&&(0,o.tryRun)(i,(null===(r=e.arguments)||void 0===r?void 0:r.map((e=>{const r=this.getLiteralFromNode(e,!1,!0,!0);return r===t.NO_LIT_FOUND?void 0:r})))||[])}}}getNumberFromNode(e){if(i.isParenthesizedExpression(e))return this.getNumberFromNode(e.expression);if(i.isNumericLiteral(e))return+e.text;const t=this.checker.getTypeAtLocation(e);return t.isNumberLiteral()?t.value:"null"===t.intrinsicName?0:void 0}getStringFromNode(e,t=!1,r=!1){if(!e)return;const n=this.getLiteralFromNode(e,t,r);return"string"===typeof n?n:void 0}getLiteralFromNode(e,r=!1,n=!1,a=!1){if(i.isParenthesizedExpression(e))return this.getLiteralFromNode(e.expression);if(i.isAsExpression(e))return this.getLiteralFromNode(e.expression);if(i.isNumericLiteral(e))return+e.text;if(i.isStringLiteral(e))return e.text;if(e.kind===i.SyntaxKind.FalseKeyword)return!1;if(e.kind===i.SyntaxKind.TrueKeyword)return!0;if(e.kind===i.SyntaxKind.NullKeyword)return null;if(i.isIdentifier(e)){if("undefined"===e.text)return;if(r)return e.text}else{if(n&&i.isTemplateExpression(e)){let t=e.head.text;for(const r of e.templateSpans){t+=(this.getLiteralFromNode(i.visitNode(r.expression,this.boundVisitor))||"").toString()+r.literal.text}return t}if(a&&i.isObjectLiteralExpression(e)){const t={};for(const s of e.properties){if(!i.isPropertyAssignment(s)||!s.initializer)continue;const e=s.name&&(0,o.getNameFromProperty)(s.name);e&&(t[e]=this.getLiteralFromNode(s.initializer,r,n,a))}return t}if(a&&i.isArrayLiteralExpression(e))return e.elements.map((e=>this.getLiteralFromNode(e,r,n,a)))}const s=this.checker.getTypeAtLocation(e);return s.isNumberLiteral()||s.isStringLiteral()||s.value?s.value:"false"!==s.intrinsicName&&("true"===s.intrinsicName||("undefined"===s.intrinsicName?void 0:"null"===s.intrinsicName?null:t.NO_LIT_FOUND))}getBoolFromNode(e){if(!e)return;if(e.kind===i.SyntaxKind.FalseKeyword||e.kind===i.SyntaxKind.NullKeyword)return!1;if(e.kind===i.SyntaxKind.TrueKeyword)return!0;if(i.isNumericLiteral(e))return"0"!==e.text;if(i.isStringLiteral(e))return""!==e.text;if(i.isArrayLiteralExpression(e)||i.isObjectLiteralElement(e))return!0;if(i.isIdentifier(e)&&"undefined"===e.text)return!1;const t=this.checker.getTypeAtLocation(e);return t.isNumberLiteral()?0!==t.value:t.isStringLiteral()?""!==t.value:!!t.getCallSignatures().length||"false"!==t.intrinsicName&&("true"===t.intrinsicName||"undefined"!==t.intrinsicName&&("null"!==t.intrinsicName&&void 0))}getTypeParam(e){var t,r;const n=this.getLastMacro();if(!n)return;const i=n.macro.typeParams.findIndex((t=>this.checker.getTypeAtLocation(t)===e));if(-1!==i&&n.call){const e=null===(t=n.call.typeArguments)||void 0===t?void 0:t[i];return e?this.checker.getTypeAtLocation(e):null===(r=this.checker.getResolvedSignature(n.call))||void 0===r?void 0:r.getTypeParameterAtPosition(i)}}findMacroByTypeParams(e,t){const r=e.name.getText(),n=this.checker.getTypeAtLocation(e.expression),i=t.arguments.map((e=>this.checker.getTypeAtLocation(e))),a=[];e:for(const[o,s]of this.macros){if(s.name!==r)continue;const e=this.checker.getTypeOfSymbolAtLocation(o,o.valueDeclaration).getCallSignatures()[0].parameters.map((e=>{const t=this.checker.getTypeOfSymbolAtLocation(e,e.valueDeclaration);return t.isTypeParameter()?t.getConstraint()||this.checker.getAnyType():t})),t=e.shift();if(this.checker.isTypeAssignableTo(n,t)){for(let t=0;t<e.length&&!s.params[t+1].spread;t++){if(!i[t]){if(e[t].getDefault()||e[t]!==e[t].getNonNullableType())continue;continue e}if(!this.checker.isTypeAssignableTo(i[t],e[t]))continue e}if(i.length>e.length){let t=this.checker.getTypeArguments(e[e.length-1])[0];if(t.isTypeParameter()&&(t=t.getConstraint()||this.checker.getAnyType()),!s.params[s.params.length-1].spread)continue;for(let r=e.length-1;r<i.length;r++)if(!this.checker.isTypeAssignableTo(i[r],t))continue e}a.push(s)}}return a}findMacroByName(e,t){const r=[];for(const[,n]of this.macros)n.name===t&&r.push(n);if(r.length>1)throw(0,o.MacroError)(e,`More than one macro with the name ${t} exists.`);return r[0]}getLastMacro(){return this.macroStack[this.macroStack.length-1]}saveAndClearEscapedStatements(e){e.push(...this.escapedStatements[this.escapedStatements.length-1]),this.escapedStatements[this.escapedStatements.length-1].length=0}escapeStatement(...e){this.escapedStatements[this.escapedStatements.length-1].push(...e)}removeEscapeScope(){this.escapedStatements.pop()}addEscapeScope(){this.escapedStatements.push([])}addComptimeSignature(e,t,r){if(this.comptimeSignatures.has(e))return this.comptimeSignatures.get(e);const n=new Function(...r,t);return this.comptimeSignatures.set(e,n),n}strToAST(e){const t=i.createSourceFile("",e,i.ScriptTarget.ESNext,!0,i.ScriptKind.TSX),r=e=>i.isNumericLiteral(e)?i.factory.createNumericLiteral(e.text):i.isStringLiteral(e)?i.factory.createStringLiteral(e.text):i.isRegularExpressionLiteral(e)?i.factory.createRegularExpressionLiteral(e.text):i.isIdentifier(e)?i.factory.createIdentifier(e.text):i.visitEachChild(e,r,this.context);return i.visitEachChild(t,r,this.context).statements}};const c={"[]":(e,t)=>i.factory.createArrayLiteralExpression(t.map((e=>i.isExpressionStatement(e)?e.expression:e))),"+":(e,t)=>(0,o.toBinaryExp)(e,t,i.SyntaxKind.PlusToken),"-":(e,t)=>(0,o.toBinaryExp)(e,t,i.SyntaxKind.MinusToken),"*":(e,t)=>(0,o.toBinaryExp)(e,t,i.SyntaxKind.AsteriskToken),"||":(e,t)=>(0,o.toBinaryExp)(e,t,i.SyntaxKind.BarBarToken),"&&":(e,t)=>(0,o.toBinaryExp)(e,t,i.SyntaxKind.AmpersandAmpersandToken),"()":(e,t)=>i.factory.createParenthesizedExpression((0,o.toBinaryExp)(e,t,i.SyntaxKind.CommaToken))}},7914:function(e,t,r){"use strict";var n=r(4250);Object.defineProperty(t,"__esModule",{value:!0}),t.normalizeFunctionNode=t.deExpandMacroResults=t.resolveTypeArguments=t.resolveTypeWithTypeParams=t.macroParamsToArray=t.tryRun=t.fnBodyToString=t.resolveAliasedSymbol=t.primitiveToNode=t.createObject=t.isStatement=t.getNameFromProperty=t.MacroErrorWrapper=t.MacroError=t.getRepetitionParams=t.toBinaryExp=t.wrapExpressions=t.flattenBody=void 0;const i=r(4625);function a(e){return"statements"in e?[...e.statements]:[i.factory.createExpressionStatement(e)]}function o(e,t){s(e.pos,e.end-e.pos,t,e.getSourceFile()),n.exit()}function s(e,t,r,a){if(!i.sys||"object"!==typeof n)throw new Error(r);console.error(i.formatDiagnosticsWithColorAndContext([{category:i.DiagnosticCategory.Error,code:8e3,file:a,start:e,length:t,messageText:r}],{getNewLine:()=>"\r\n",getCurrentDirectory:i.sys.getCurrentDirectory,getCanonicalFileName:e=>e}))}function c(e){return e.kind>=i.SyntaxKind.Block&&e.kind<=i.SyntaxKind.MissingDeclaration}t.flattenBody=a,t.wrapExpressions=function(e){let t=e.pop();return i.isExpressionStatement(t)?t=i.factory.createReturnStatement(t.expression):t.kind>i.SyntaxKind.EmptyStatement&&t.kind<i.SyntaxKind.DebuggerStatement||(t=i.factory.createReturnStatement(t)),i.factory.createImmediatelyInvokedArrowFunction([...e,t])},t.toBinaryExp=function(e,t,r){let n;for(const a of t.map((e=>i.isExpressionStatement(e)?e.expression:e)))n=n?e.context.factory.createBinaryExpression(n,r,a):a;return i.visitNode(n,e.boundVisitor)},t.getRepetitionParams=function(e){const t={literals:[]},r=e.elements[0];i.isStringLiteral(r)?t.separator=r.text:i.isArrayLiteralExpression(r)?t.literals.push(...r.elements):i.isArrowFunction(r)&&(t.function=r);const n=e.elements[1];n&&(i.isArrayLiteralExpression(n)?t.literals.push(...n.elements):i.isArrowFunction(n)&&(t.function=n));const a=e.elements[2];if(a&&i.isArrowFunction(a)&&(t.function=a),!t.function)throw o(e,"Repetition must include arrow function.");return t},t.MacroError=o,t.MacroErrorWrapper=s,t.getNameFromProperty=function(e){return i.isIdentifier(e)||i.isStringLiteral(e)||i.isPrivateIdentifier(e)||i.isNumericLiteral(e)?e.text:void 0},t.isStatement=c,t.createObject=function(e){const t=[];for(const r in e){const n=e[r];t.push(i.factory.createPropertyAssignment(r,n?c(n)?i.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,i.isBlock(n)?n:i.factory.createBlock([n])):n:i.factory.createIdentifier("undefined")))}return i.factory.createObjectLiteralExpression(t)},t.primitiveToNode=function e(t){if("string"===typeof t)return i.factory.createStringLiteral(t);if("number"===typeof t)return i.factory.createNumericLiteral(t);if("boolean"===typeof t)return t?i.factory.createTrue():i.factory.createFalse();if(null===t)return i.factory.createNull();if(Array.isArray(t))return i.factory.createArrayLiteralExpression(t.map((t=>e(t))));{const r=[];for(const n in t)r.push(i.factory.createPropertyAssignment(n,e(t[n])));return i.factory.createObjectLiteralExpression(r)}},t.resolveAliasedSymbol=function(e,t){if(t){for(;0!==(t.flags&i.SymbolFlags.Alias);){const r=e.getAliasedSymbol(t);if("unknown"===r.name)return t;t=r}return t}},t.fnBodyToString=function e(t,r){if(!r.body)return"";const n=new Set;let a="";const o=s=>{if(i.isCallExpression(s)){const c=t.getResolvedSignature(s);if(c&&c.declaration&&c.declaration!==r&&c.declaration.parent.parent!==r&&(i.isFunctionDeclaration(c.declaration)||i.isArrowFunction(c.declaration)||i.isFunctionExpression(c.declaration))){const r=c.declaration.name?c.declaration.name.text:i.isIdentifier(s.expression)?s.expression.text:void 0;if(!r||n.has(r))return;n.add(r),a+=`function ${r}(${c.parameters.map((e=>e.name)).join(",")}){${e(t,c.declaration)}}`}i.forEachChild(s,o)}else i.forEachChild(s,o)};return i.forEachChild(r.body,o),a+i.transpile((r.body.original||r.body).getText())},t.tryRun=function(e,t=[],r){var n;try{return e(...t)}catch(a){if(!(a instanceof Error))throw a;{const{line:t,col:s}=(null===(n=(a.stack||"").match(/<anonymous>:(?<line>\d+):(?<col>\d+)/))||void 0===n?void 0:n.groups)||{},c=t?+t-1:0,l=s?+s-1:0,u=i.createSourceFile("comptime",e.toString(),i.ScriptTarget.ES2020,!0,i.ScriptKind.JS),d=i.getPositionOfLineAndCharacter(u,c,l);o(i.getTokenAtPosition(u,d),(r||"")+a.message)}}},t.macroParamsToArray=function(e,t){const r=[];for(let n=0;n<e.length;n++)e[n].spread?r.push(t.slice(n)):!t[n]&&e[n].defaultVal?r.push(e[n].defaultVal):r.push(t[n]);return r},t.resolveTypeWithTypeParams=function e(t,r,n){if("indexType"in t&&"objectType"in t){const i=e(t.indexType,r,n),a=e(t.objectType,r,n),o=i.isTypeParameter()?n[r.findIndex((e=>e===i))]:i;if(!o||!o.isLiteral())return t;const s=a.getProperty(o.value.toString());return s?t.checker.getTypeOfSymbol(s):t}if("checkType"in t&&"extendsType"in t){const i=e(t.checkType,r,n),a=e(t.extendsType,r,n),o=e(t.resolvedTrueType,r,n),s=e(t.resolvedFalseType,r,n);return t.checker.isTypeAssignableTo(i,a)?o:s}if(t.isIntersection()){const i=new Map;for(const a of t.types){const t=e(a,r,n);for(const e of t.getProperties())i.set(e.name,e)}return t.checker.createAnonymousType(void 0,i,[],[],[])}return t.isTypeParameter()&&n[r.findIndex((e=>e===t))]||t},t.resolveTypeArguments=function(e,t){var r;const n=e.getResolvedSignature(t);if(!n||!n.mapper)return[];switch(n.mapper.kind){case i.TypeMapKind.Simple:return[n.mapper.target];case i.TypeMapKind.Array:return(null===(r=n.mapper.targets)||void 0===r?void 0:r.filter((e=>e)))||[];default:return[]}},t.deExpandMacroResults=function(e){const t=[...e],r=t[e.length-1];if(!r)return[e];if(i.isReturnStatement(r)){const r=t.pop().expression;if(!r)return[e];if(i.isCallExpression(r)&&i.isParenthesizedExpression(r.expression)&&i.isArrowFunction(r.expression.expression)){const e=a(r.expression.expression.body);let n=e.pop();return n&&i.isReturnStatement(n)&&n.expression&&(n=n.expression),[[...t,...e],n]}return[t,r]}return[t,t[t.length-1]]},t.normalizeFunctionNode=function(e,t){var r;if(i.isArrowFunction(t)||i.isFunctionExpression(t)||i.isFunctionDeclaration(t))return t;const n=e.getSymbolAtLocation(t);if(n&&(null===(r=n.declarations)||void 0===r?void 0:r.length)){const e=n.declarations[0];if(i.isFunctionLikeDeclaration(e))return e;if(i.isVariableDeclaration(e)&&e.initializer&&i.isFunctionLikeDeclaration(e.initializer))return e.initializer}}},3841:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=3841,e.exports=t},5301:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(2412)}])},1115:function(e,t,r){"use strict";r.d(t,{y:function(){return l}});var n=r(4051),i=r.n(n),a=r(5893),o=r(9604),s=r(7294);function c(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(l){return void r(l)}s.done?t(c):Promise.resolve(c).then(n,i)}function l(e){var t=(0,s.useState)(),r=t[0],n=t[1],l=(0,o.Ik)();return(0,s.useEffect)((function(){var t;l&&(t=i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.editor.colorize(e.text,"javascript",{tabSize:4});case 2:r=t.sent,n(r);case 4:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))})()}),[l,e.text]),(0,a.jsx)("div",{children:r&&(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:r},style:{backgroundColor:"#1e1e1e",overflowY:"auto",paddingLeft:"15px",height:"calc(80vh - 50px)",fontFamily:"monospace",overflowX:"hidden"}})})}},1682:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{e:function(){return Runnable}});var _home_runner_work_ts_macros_ts_macros_playground_node_modules_next_dist_compiled_regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4051),_home_runner_work_ts_macros_ts_macros_playground_node_modules_next_dist_compiled_regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_home_runner_work_ts_macros_ts_macros_playground_node_modules_next_dist_compiled_regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_0__),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5893),react_split_pane__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5884),_Highlight__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1115),_css_App_module_css__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8836),_css_App_module_css__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_css_App_module_css__WEBPACK_IMPORTED_MODULE_5__),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7294);function asyncGeneratorStep(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(l){return void r(l)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){asyncGeneratorStep(a,n,i,o,s,"next",e)}function s(e){asyncGeneratorStep(a,n,i,o,s,"throw",e)}o(void 0)}))}}function Runnable(props){var ref=(0,react__WEBPACK_IMPORTED_MODULE_4__.useState)(),evalRes=ref[0],setEvalRes=ref[1];return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)(react_split_pane__WEBPACK_IMPORTED_MODULE_2__.Z,{split:"horizontal",defaultSize:"70%",primary:"first",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("div",{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_Highlight__WEBPACK_IMPORTED_MODULE_3__.y,{text:props.code})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("div",{className:_css_App_module_css__WEBPACK_IMPORTED_MODULE_5___default().runSection,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("button",{className:_css_App_module_css__WEBPACK_IMPORTED_MODULE_5___default().button,onClick:_asyncToGenerator(_home_runner_work_ts_macros_ts_macros_playground_node_modules_next_dist_compiled_regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(){return _home_runner_work_ts_macros_ts_macros_playground_node_modules_next_dist_compiled_regenerator_runtime_runtime_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_ctx){for(;;)switch(_ctx.prev=_ctx.next){case 0:return _ctx.prev=0,_ctx.t0=setEvalRes,_ctx.next=4,eval(props.code);case 4:_ctx.t1=_ctx.sent,(0,_ctx.t0)(_ctx.t1),_ctx.next=11;break;case 8:_ctx.prev=8,_ctx.t2=_ctx.catch(0),setEvalRes(_ctx.t2.toString());case 11:case"end":return _ctx.stop()}}),_callee,null,[[0,8]])}))),children:"Run"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("br",{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("p",{className:_css_App_module_css__WEBPACK_IMPORTED_MODULE_5___default().runSectionResult,children:evalRes})]})]})}},2412:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSG:function(){return E},default:function(){return S}});var n=r(5893),i=r(5423),a=r.n(i),o=r(3349),s='\ndeclare function $$loadEnv(path?: string) : void;\ndeclare function $$readFile(path: string, parseJSON?: false) : string;\ndeclare function $$inlineFunc<R = any>(func: Function, ...params: Array<unknown>) : R;\ndeclare function $$inline<F extends (...args: any) => any>(func: F, params: Parameters<F>, doNotCall: any) : () => ReturnType<F>;\ndeclare function $$inline<F extends (...args: any) => any>(func: F, params: Parameters<F>) : ReturnType<F>;\ndeclare function $$kindof(ast: unknown) : number;\ndeclare function $$define(varname: string, initializer: unknown, let?: boolean) : number;\ndeclare function $$i() : number;\ndeclare function $$length(arr: Array<any>|string) : number;\ndeclare function $$ident(str: string) : any;\ndeclare function $$err(str: string) : void;\ndeclare function $$includes<T>(arr: Array<T>, val: T) : boolean;\ndeclare function $$includes(arr: string, val: string) : boolean;\ndeclare function $$slice<T>(str: Array<T>, start?: number, end?: number) : Array<T>;\ndeclare function $$slice(str: string, start?: number, end?: number) : string;\ndeclare function $$ts<T = unknown>(code: string) : T;\ndeclare function $$escape<T>(code: () => T) : T;\ndeclare function $$typeToString<T>(simplify?: boolean, nonNull?: boolean) : string;\ndeclare function $$propsOfType<T>() : Array<string>;\ndeclare function $$comptime(fn: () => void) : void;\ninterface RawContext {\n    ts: any,\n    factory: any,\n    transformer: any,\n    checker: any,\n    thisMacro: any\n}\ndeclare function $$raw<T>(fn: (ctx: RawContext, ...args: any[]) => ts.Node | ts.Node[] | undefined) : T;\ndeclare function $$setStore(key: string, value: any) : void;\ndeclare function $$getStore<T>(key: string) : T;\ntype Accumulator = number & { __marker?: "Accumulator" };\ntype Save<T> = T & { __marker?: "Save" };\ntype EmptyDecorator = (...props: any) => void;\nconst enum LabelKinds {\n    If,\n    ForIter,\n    For,\n    While,\n    Block\n}\ninterface IfLabel {\n    kind: LabelKinds.If\n    condition: any,\n    then: any,\n    else: any\n}\ninterface ForIterLabel {\n    kind: LabelKinds.ForIter,\n    type: "in" | "of",\n    initializer: any,\n    iterator: any,\n    statement: any\n}\ninterface ForLabel {\n    kind: LabelKinds.For,\n    initializer: {\n        expression?: any,\n        variables?: Array<[variableName: string, initializer: any]>\n    },\n    condition: any,\n    increment: any,\n    statement: any\n}\ninterface WhileLabel {\n    kind: LabelKinds.While,\n    do: boolean,\n    condition: any,\n    statement: any\n}\ninterface BlockLabel {\n    kind: LabelKinds.Block,\n    statement: any\n}\ntype Label = IfLabel | ForIterLabel | ForLabel | WhileLabel | BlockLabel;\n',c={noImplicitAny:!0,strictNullChecks:!0,target:a().ScriptTarget.ESNext,experimentalDecorators:!0};var l=r(7294),u=r(9604);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){var t=(0,u.Ik)();return(0,l.useEffect)((function(){if(t){t.languages.typescript.javascriptDefaults.setCompilerOptions(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){d(e,t,r[t])}))}return e}({},c)),t.languages.typescript.typescriptDefaults.setDiagnosticsOptions({diagnosticCodesToIgnore:[1219]});var e="ts:ts-macros/index.d.ts";t.languages.typescript.javascriptDefaults.addExtraLib(s,e),t.editor.createModel(s,"typescript",t.Uri.parse(e))}}),[t]),(0,n.jsx)(u.ZP,{height:"calc(90vh - 50px)",language:"typescript",theme:"vs-dark",value:e.code,onChange:e.onChange})}var f=r(1682),m=r(5884),y=r(6961),h=r(8836),g=r.n(h),x=(r(4444),['function $contains<T>(value: T, possible: Array<T>) {\n    return +["||", [possible], (val: T) => value === val];\n}\n    \nconst searchItem = "google";\n$contains!(searchItem, ["erwin", "tj"]);',"function $try(resultObj: Save<{ value?: number, is_err: () => boolean}>) {\n    $$escape!(() => {\n        if (resultObj.is_err()) {\n            return resultObj;\n        }\n    });\n    return resultObj.value;\n}\n\n(() => {\n    const a = $try!({ value: 123, is_err: () => false });\n});",'type ClassInfo = { name: string, value: string };\n\nfunction $makeClasses(...info: Array<ClassInfo>) {\n    +[[info], (classInfo: ClassInfo) => {\n        $$ts!(`\n            class ${classInfo.name} {\n                constructor() {\n                    this.value = ${classInfo.value}\n                }\n            }\n        `);\n    }];\n}\n\n$makeClasses!({name: "A", value: "123"}, {name: "B", value: "345"});','function $map<T, R>(arr: Save<Array<T>>, cb: (item: T) => R) : Array<R> {\n    $$escape!(() => {\n        const res = [];\n        for (let i=0; i < arr.length; i++) {\n        res.push($$inlineFunc!(cb, arr[i]));\n        }\n    });\n    return $$ident!("res");\n}\n\n(() => {\n    $map!([1, 2, 3, 4, 5, 6, 7, 8, 9], (num) => num * 2);\n})();',"function $ToInterval(info: WhileLabel, intervalTimer = 1000) {\n    const interval = setInterval(() => {\n        if (info.condition) {\n            $$inlineFunc!(info.statement);\n        } else {\n            clearInterval(interval);\n        }\n    }, intervalTimer);\n}\n\nconst arr = [1, 3, 4, 5, 6];\n\n$ToInterval:\nwhile (arr.length !== 0) {\n    console.log(arr.pop());\n}",'\nfunction $renameClass(newName: string) : EmptyDecorator {\n    return $$raw!((ctx, newNameNode) => {\n       const target = ctx.thisMacro.target;\n       return ctx.factory.updateClassDeclaration(\n            target,\n            target.modifiers?.filter(m => m.kind !== ctx.ts.SyntaxKind.Decorator),\n            ctx.factory.createIdentifier(newNameNode.text),\n            target.typeParameters,\n            target.heritageClauses,\n            target.members\n        )\n    });\n}\n\n@$renameClass!("NewTest")\nclass Test {\n    propA: number\n    propB: string\n    constructor(a: number, b: string) {\n        this.propA = a;\n        this.propB = b;\n    }\n}\n']),_="\n// Interactive playground!\n// Write your code here and see the transpiled result.\n// All types and functions from the library are already imported!\n\n".concat(x[Math.floor(Math.random()*x.length)],"\n");function v(e){var t=e.transpile,r=(0,l.useState)(_),i=r[0],a=r[1],o=(0,l.useState)(""),s=o[0],c=o[1];return(0,l.useEffect)((function(){var e=Object.fromEntries(new URLSearchParams(window.location.search).entries());if(e.code){var r=(0,y.decompressFromEncodedURIComponent)(e.code);if(!r)return;a(r);var n=t(r),i=n.code,o=n.error;c(i||""+o)}else c(t(_).code)}),[]),(0,n.jsxs)("div",{children:[(0,n.jsxs)("header",{className:g().header,children:[(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("h2",{children:"Typescript Macros"}),(0,n.jsx)("button",{className:g().button,onClick:function(){i&&navigator.permissions.query({name:"clipboard-write"}).then((function(e){"granted"!=e.state&&"prompt"!=e.state||navigator.clipboard.writeText(location.origin+location.pathname+"?code=".concat((0,y.compressToEncodedURIComponent)(i)))}))},children:"Copy Link"})]}),(0,n.jsx)("a",{href:"https://github.com/GoogleFeud/ts-macros",style:{fontSize:"24px"},children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"currentColor",viewBox:"0 0 16 16",children:(0,n.jsx)("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})})})]}),(0,n.jsxs)(m.Z,{split:"vertical",defaultSize:"50%",primary:"first",children:[(0,n.jsx)(p,{code:i,onChange:function(e){a(e);var r=t(e||""),n=r.code,i=r.error;c(n||""+i)}}),(0,n.jsx)(f.e,{code:s})]}),(0,n.jsx)("footer",{className:g().footer,children:(0,n.jsxs)("p",{children:["Made with \u2764\ufe0f by ",(0,n.jsx)("a",{href:"https://github.com/GoogleFeud",children:"GoogleFeud"}),"."]})})]})}var E=!0;function S(e){var t=function(e){var t=a().createSourceFile("lib.d.ts",e+s,c.target||a().ScriptTarget.ESNext,!0,a().ScriptKind.TS);return function(e){var r=a().createSourceFile("module.ts",e,c.target||a().ScriptTarget.ESNext,!0),n="",i={getSourceFile:function(e){return e.endsWith(".d.ts")?t:r},getDefaultLibFileName:function(){return"lib.d.ts"},useCaseSensitiveFileNames:function(){return!1},writeFile:function(e,t){return n=t},getCanonicalFileName:function(e){return e},getCurrentDirectory:function(){return""},getNewLine:function(){return"\n"},fileExists:function(){return!0},readFile:function(){return""},directoryExists:function(){return!0},getDirectories:function(){return[]}},s=a().createProgram(["module.ts"],c,i);window.checker=s.getTypeChecker(),window.source=r;try{o.wN.clear(),s.emit(void 0,void 0,void 0,void 0,{before:[(0,o.ZP)(s)]})}catch(l){return console.log(l),{error:l}}return{code:n}}}(e.lib);return(0,n.jsx)(v,{transpile:t})}},8836:function(e){e.exports={header:"App_header__3xFa8",footer:"App_footer__qJi0F",button:"App_button__Z9okP",runSection:"App_runSection__ptbmi",runSectionResult:"App_runSectionResult__ZpuvE"}},3411:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=3411,e.exports=t},9939:function(){},175:function(){},4250:function(){},7424:function(){},9107:function(){},444:function(){},6170:function(){},1157:function(){},1638:function(){},9528:function(){},1206:function(){},2183:function(){},3024:function(){},2715:function(){},3611:function(){},8353:function(){},1210:function(){},5573:function(){},3454:function(){},4444:function(){}},function(e){e.O(0,[138,21,961,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);