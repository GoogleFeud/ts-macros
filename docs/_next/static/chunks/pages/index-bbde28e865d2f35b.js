(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{4965:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.labelActions=t.unaryActions=t.possiblyUnknownValueBinaryActions=t.binaryActions=t.binaryNumberActions=void 0;const n=r(4625),a=r(7914);t.binaryNumberActions={[n.SyntaxKind.MinusToken]:(e,t)=>n.factory.createNumericLiteral(e-t),[n.SyntaxKind.AsteriskToken]:(e,t)=>n.factory.createNumericLiteral(e*t),[n.SyntaxKind.SlashToken]:(e,t)=>n.factory.createNumericLiteral(e/t),[n.SyntaxKind.LessThanToken]:(e,t)=>e<t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.LessThanEqualsToken]:(e,t)=>e<=t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.GreaterThanToken]:(e,t)=>e>t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.GreaterThanEqualsToken]:(e,t)=>e>=t?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.AmpersandToken]:(e,t)=>n.factory.createNumericLiteral(e&t),[n.SyntaxKind.BarToken]:(e,t)=>n.factory.createNumericLiteral(e|t),[n.SyntaxKind.CaretToken]:(e,t)=>n.factory.createNumericLiteral(e^t),[n.SyntaxKind.PercentToken]:(e,t)=>n.factory.createNumericLiteral(e%t)},t.binaryActions={[n.SyntaxKind.PlusToken]:(e,t,r,a)=>"string"===typeof r||"string"===typeof a?n.factory.createStringLiteral(r+a):"number"===typeof r||"number"===typeof a?n.factory.createNumericLiteral(r+a):void 0,[n.SyntaxKind.EqualsEqualsEqualsToken]:(e,t,r,a)=>r===a?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.EqualsEqualsToken]:(e,t,r,a)=>r==a?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.ExclamationEqualsEqualsToken]:(e,t,r,a)=>r!==a?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.ExclamationEqualsToken]:(e,t,r,a)=>r!=a?n.factory.createTrue():n.factory.createFalse(),[n.SyntaxKind.AmpersandAmpersandToken]:(e,t,r,n)=>r&&n?t:r?n?void 0:t:e,[n.SyntaxKind.BarBarToken]:(e,t,r,n)=>r?e:t},t.possiblyUnknownValueBinaryActions={[n.SyntaxKind.AmpersandAmpersandToken]:(e,t,r)=>{if(r!==a.NO_LIT_FOUND)return r?t:e},[n.SyntaxKind.BarBarToken]:(e,t,r)=>{if(r!==a.NO_LIT_FOUND)return r?e:t}},t.unaryActions={[n.SyntaxKind.ExclamationToken]:e=>e?n.factory.createFalse():n.factory.createTrue(),[n.SyntaxKind.MinusToken]:e=>{if("number"===typeof e)return n.factory.createNumericLiteral(-e)},[n.SyntaxKind.TildeToken]:e=>{if("number"===typeof e)return n.factory.createNumericLiteral(~e)},[n.SyntaxKind.PlusToken]:e=>{if("number"===typeof e||"string"===typeof e)return n.factory.createNumericLiteral(+e)}},t.labelActions={[n.SyntaxKind.IfStatement]:e=>(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(0),condition:e.expression,then:e.thenStatement,else:e.elseStatement}),[n.SyntaxKind.ForOfStatement]:e=>{let t;if(n.isVariableDeclarationList(e.initializer)){const r=e.initializer.declarations[0];r&&n.isIdentifier(r.name)&&(t=r.name)}else t=e.initializer;return(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(1),type:n.factory.createStringLiteral("of"),initializer:t,iterator:e.expression,statement:e.statement})},[n.SyntaxKind.ForInStatement]:e=>{let t;if(n.isVariableDeclarationList(e.initializer)){const r=e.initializer.declarations[0];r&&n.isIdentifier(r.name)&&(t=r.name)}else t=e.initializer;return(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(1),type:n.factory.createStringLiteral("in"),initializer:t,iterator:e.expression,statement:e.statement})},[n.SyntaxKind.WhileStatement]:e=>(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(3),do:n.factory.createFalse(),condition:e.expression,statement:e.statement}),[n.SyntaxKind.DoStatement]:e=>(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(3),do:n.factory.createTrue(),condition:e.expression,statement:e.statement}),[n.SyntaxKind.ForStatement]:e=>{let t,r;if(e.initializer)if(n.isVariableDeclarationList(e.initializer)){t=[];for(const r of e.initializer.declarations)n.isIdentifier(r.name)&&t.push(n.factory.createArrayLiteralExpression([n.factory.createIdentifier(r.name.text),r.initializer||n.factory.createIdentifier("undefined")]))}else r=e.initializer;return(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(2),initializer:(0,a.createObjectLiteral)({variables:t&&n.factory.createArrayLiteralExpression(t),expression:r}),condition:e.condition,increment:e.incrementor,statement:e.statement})},[n.SyntaxKind.Block]:e=>(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(4),statement:e}),[n.SyntaxKind.VariableStatement]:e=>{const t=[],r=[];for(const a of e.declarationList.declarations)n.isIdentifier(a.name)&&(t.push(a.name),r.push(a.initializer||n.factory.createIdentifier("undefined")));return(0,a.createObjectLiteral)({kind:n.factory.createNumericLiteral(5),identifiers:n.factory.createArrayLiteralExpression(t),initializers:n.factory.createArrayLiteralExpression(r),declarationType:(0,a.hasBit)(e.declarationList.flags,n.NodeFlags.Const)?n.factory.createStringLiteral("const"):(0,a.hasBit)(e.declarationList.flags,n.NodeFlags.Let)?n.factory.createStringLiteral("let"):n.factory.createStringLiteral("var")})}}},3349:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MacroError=t.macros=void 0;const n=r(249);t.macros=new Map,t.default=(e,r)=>a=>{const i=e.getTypeChecker(),o=new n.MacroTransformer(a,i,t.macros,r);return e=>o.run(e)};var a=r(7914);Object.defineProperty(t,"MacroError",{enumerable:!0,get:function(){return a.MacroError}})},5780:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4625),a=r(9939),i=r(175),o=r(7914),s={},c={};t.default={$$loadEnv:{call:(e,t,a)=>{const s=e.length&&n.isStringLiteral(e[0])?e[0].text:"";let c;try{c=r(Object(function(){var e=new Error("Cannot find module 'dotenv'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(l){throw new o.MacroError(a,"`loadEnv` macro called but `dotenv` module is not installed.")}return s?c.config({path:i.join(n.sys.getCurrentDirectory(),s)}):c.config(),t.props.optimizeEnv=!0,t.context.factory.createCallExpression(t.context.factory.createPropertyAccessExpression(t.context.factory.createCallExpression(t.context.factory.createIdentifier("require"),void 0,[t.context.factory.createStringLiteral("dotenv")]),t.context.factory.createIdentifier("config")),void 0,s?[t.context.factory.createObjectLiteralExpression([t.context.factory.createPropertyAssignment(t.context.factory.createIdentifier("path"),t.context.factory.createStringLiteral(s))])]:[])}},$$readFile:{call:([e,t],r,i)=>{const l=e&&r.getStringFromNode(e,!1,!0);if(!l)throw new o.MacroError(i,"`readFile` macro expects a path to the JSON file as the first parameter.");const p=t&&r.getBoolFromNode(t);if(p){if(s[l])return s[l]}else if(c[l])return n.factory.createStringLiteral(c[l]);const u=a.readFileSync(l,"utf-8");if(p){const e=(0,o.primitiveToNode)(JSON.parse(u));return s[l]=e,e}return c[l]=u,n.factory.createStringLiteral(u)}},$$inline:{call:([e,t,r],a,i)=>{if(!e)throw new o.MacroError(i,"`inline` macro expects a function as the first argument.");if(!t||!n.isArrayLiteralExpression(t))throw new o.MacroError(i,"`inline` macro expects an array of expressions as the second argument.");const s=(0,o.normalizeFunctionNode)(a.checker,e);if(!s||!s.body)throw new o.MacroError(i,"`inline` macro expects a function as the first argument.");let c;if(s.parameters.length){const e=new Map;for(let a=0;a<s.parameters.length;a++){const r=s.parameters[a];n.isIdentifier(r.name)&&e.set(r.name.text,t.elements[a])}const r=t=>n.isIdentifier(t)&&e.has(t.text)?e.get(t.text):n.visitEachChild(t,r,a.context);a.context.suspendLexicalEnvironment(),c=n.visitFunctionBody(s.body,r,a.context)}else c=s.body;return r?n.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,c):n.isBlock(c)?c.statements:c}},$$kindof:{call:(e,t,r)=>{if(!e.length)throw new o.MacroError(r,"`kindof` macro expects a single argument.");return t.context.factory.createNumericLiteral(e[0].kind)}},$$define:{call:([e,t,r,a],i,s)=>{const c=i.getStringFromNode(e,!0,!0);if(!c)throw new o.MacroError(s,"`define` macro expects a string literal as the first argument.");const l=i.context.factory.createVariableDeclarationList([i.context.factory.createVariableDeclaration(c,void 0,void 0,t)],i.getBoolFromNode(r)?n.NodeFlags.Let:n.NodeFlags.Const);return n.isForStatement(s.parent)?l:n.factory.createVariableStatement(i.getBoolFromNode(a)?[n.factory.createToken(n.SyntaxKind.ExportKeyword)]:void 0,l)}},$$i:{call:(e,t)=>t.repeat.length?t.context.factory.createNumericLiteral(t.repeat[t.repeat.length-1].index):t.context.factory.createNumericLiteral(-1)},$$length:{call:([e],t,r)=>{if(!e)throw new o.MacroError(r,"`length` macro expects an array / string literal as the first argument.");if(n.isArrayLiteralExpression(e))return t.context.factory.createNumericLiteral(e.elements.length);const a=t.getStringFromNode(e,!0,!0);if(a)return t.context.factory.createNumericLiteral(a.length);throw new o.MacroError(r,"`length` macro expects an array / string literal as the first argument.")}},$$ident:{call:([e],t,r)=>{var a,i;if(!e)throw new o.MacroError(r,"`ident` macro expects a string literal as the first parameter.");const s=t.getStringFromNode(e,!0,!0);return s?(null===(i=null===(a=t.getLastMacro())||void 0===a?void 0:a.defined)||void 0===i?void 0:i.get(s))||n.factory.createIdentifier(s):e}},$$err:{call:([e],t,r)=>{const n=t.getStringFromNode(e,!1,!0);if(!n)throw new o.MacroError(r,"`err` macro expects a string literal as the first argument.");const a=t.macroStack.pop();throw new o.MacroError(r,`${a?`In macro ${a.macro.name}: `:""}${n}`)}},$$includes:{call:([e,t],r,a)=>{if(!e)throw new o.MacroError(a,"`includes` macro expects an array/string literal as the first argument.");if(!t)throw new o.MacroError(a,"`includes` macro expects a second argument.");const i=r.getStringFromNode(e,!1,!0);if(i){const e=r.getLiteralFromNode(t);if("string"!==typeof e)throw new o.MacroError(a,"`includes` macro expects a string literal as the second argument.");return i.includes(e)?n.factory.createTrue():n.factory.createFalse()}if(n.isArrayLiteralExpression(e)){return e.elements.map((e=>r.getLiteralFromNode(r.expectExpression(e)))).includes(r.getLiteralFromNode(t))?n.factory.createTrue():n.factory.createFalse()}throw new o.MacroError(a,"`includes` macro expects an array/string literal as the first argument.")}},$$ts:{call:([e],t,r)=>{const a=t.getStringFromNode(t.expectExpression(e),!0,!0);if(!a)throw new o.MacroError(r,"`ts` macro expects a string as it's first argument.");const i=n.createSourceFile("expr",a,n.ScriptTarget.ESNext,!1,n.ScriptKind.JS),s=e=>n.factory.cloneNode(n.visitEachChild(e,s,t.context));return n.visitNodes(i.statements,s)}},$$escape:{call:([e],t,r)=>{if(!e)throw new o.MacroError(r,"`escape` macro expects a function as it's first argument.");const a=(0,o.normalizeFunctionNode)(t.checker,t.expectExpression(e));if(!a||!a.body)throw new o.MacroError(r,"`escape` macro expects a function as it's first argument.");if(!n.isBlock(a.body))return a.body;{const e=[...t.makeHygienic(a.body.statements)],r=e.pop();if(t.escapeStatement(...e),r){if(n.isReturnStatement(r))return r.expression;if(!e.length&&n.isExpression(r))return r;t.escapeStatement(r)}}}},$$slice:{call:([e,t,r],a,i)=>{if(!e)throw new o.MacroError(i,"`slice` macro expects an array/string literal as the first argument.");const s=t&&a.getNumberFromNode(t)||-1/0,c=r&&a.getNumberFromNode(r)||1/0,l=a.getStringFromNode(e,!1,!0);if(l)return n.factory.createStringLiteral(l.slice(s,c));if(n.isArrayLiteralExpression(e))return n.factory.createArrayLiteralExpression(e.elements.slice(s,c));throw new o.MacroError(i,"`slice` macro expects an array/string literal as the first argument.")}},$$propsOfType:{call:(e,t,r)=>{const a=t.resolveTypeArgumentOfCall(r,0);if(!a)throw new o.MacroError(r,"`propsOfType` macro expects one type parameter.");return n.factory.createArrayLiteralExpression(a.getProperties().map((e=>n.factory.createStringLiteral(e.name))))}},$$typeToString:{call:([e,t,r],a,i)=>{let s=a.resolveTypeArgumentOfCall(i,0);if(!s)throw new o.MacroError(i,"`typeToString` macro expects one type parameter.");return a.getBoolFromNode(e)&&(s=(0,o.getGeneralType)(a.checker,s)),a.getBoolFromNode(t)&&(s=a.checker.getNonNullableType(s)),n.factory.createStringLiteral(a.checker.typeToString(s,void 0,a.getBoolFromNode(r)?n.TypeFormatFlags.NoTruncation:void 0))}},$$typeAssignableTo:{call:(e,t,r)=>{const a=t.resolveTypeArgumentOfCall(r,0),i=t.resolveTypeArgumentOfCall(r,1);if(!a||!i)throw new o.MacroError(r,"`typeAssignableTo` macro expects two type parameters.");return t.checker.isTypeAssignableTo(a,i)?n.factory.createTrue():n.factory.createFalse()}},$$typeMetadata:{call:([e,t],r,a)=>{var i;const s=r.resolveTypeArgumentOfCall(a,0);if(!s)throw new o.MacroError(a,"`typeMetadata` macro expects a type parameter.");const c=r.getBoolFromNode(e),l=r.getBoolFromNode(t),p=[],u=[],f=e=>n.factory.createStringLiteral(r.checker.typeToString(r.checker.getNonNullableType(e),void 0,n.TypeFormatFlags.NoTruncation));for(const d of s.getProperties()){const e=d.valueDeclaration;if(!e)continue;const t=r.checker.getTypeOfSymbolAtLocation(d,e),a=t.getCallSignatures()[0];a&&l?p.push(n.factory.createObjectLiteralExpression([n.factory.createPropertyAssignment("name",n.factory.createStringLiteral(d.name)),n.factory.createPropertyAssignment("tags",n.factory.createObjectLiteralExpression(n.getJSDocTags(e).map((e=>n.factory.createPropertyAssignment(e.tagName.text,"string"===typeof e.comment?n.factory.createStringLiteral(e.comment):n.factory.createTrue()))))),n.factory.createPropertyAssignment("parameters",n.factory.createArrayLiteralExpression(a.getParameters().map((e=>{const t=r.checker.getTypeOfSymbol(e);return n.factory.createObjectLiteralExpression([n.factory.createPropertyAssignment("name",n.factory.createStringLiteral(e.name)),n.factory.createPropertyAssignment("type",f(t)),n.factory.createPropertyAssignment("optional",(0,o.hasBit)(e.flags,n.SymbolFlags.Optional)?n.factory.createTrue():n.factory.createFalse())])})))),n.factory.createPropertyAssignment("returnType",f(a.getReturnType()))])):!a&&c&&u.push(n.factory.createObjectLiteralExpression([n.factory.createPropertyAssignment("name",n.factory.createStringLiteral(d.name)),n.factory.createPropertyAssignment("tags",n.factory.createObjectLiteralExpression(n.getJSDocTags(e).map((e=>n.factory.createPropertyAssignment(e.tagName.text,"string"===typeof e.comment?n.factory.createStringLiteral(e.comment):n.factory.createTrue()))))),n.factory.createPropertyAssignment("type",f(t)),n.factory.createPropertyAssignment("optional",(0,o.hasBit)(d.flags,n.SymbolFlags.Optional)?n.factory.createTrue():n.factory.createFalse())]))}return n.factory.createObjectLiteralExpression([n.factory.createPropertyAssignment("name",n.factory.createStringLiteral((null===(i=s.symbol)||void 0===i?void 0:i.name)||"anonymous")),n.factory.createPropertyAssignment("properties",n.factory.createArrayLiteralExpression(u)),n.factory.createPropertyAssignment("methods",n.factory.createArrayLiteralExpression(p))])}},$$text:{call:([e],t,r)=>{if(!e)throw new o.MacroError(r,"`text` macro expects an expression.");return(0,o.expressionToStringLiteral)(e)}},$$decompose:{call:([e],t)=>{if(!e)return n.factory.createArrayLiteralExpression([]);const r=[];return n.visitEachChild(e,(e=>(n.isExpression(e)&&r.push(e),e)),t.context),n.factory.createArrayLiteralExpression(r)}},$$map:{call:([e,t],r,a)=>{const i=r.getLastMacro();if(!i)throw new o.MacroError(a,"`$$map` macro can only be used inside other macros.");if(!e)throw new o.MacroError(a,"`$$map` macro expects an expression as it's first argument.");if(!t)throw new o.MacroError(a,"`$$map` macro expects a function expression as it's second argument.");const s=(0,o.normalizeFunctionNode)(r.checker,t);if(!s||!s.body)throw new o.MacroError(a,"`$$map` macro expects a function as it's second argument.");if(!s.parameters.length||!n.isIdentifier(s.parameters[0].name))throw new o.MacroError(a,"`$$map` macro expects the function to have a parameter.");const c=s.parameters[0].name.text,l=s.parameters[1]&&n.isIdentifier(s.parameters[1].name)&&s.parameters[1].name.text,p=e=>{const t=n.visitNode(e,r.boundVisitor);if(!t)return e;if(!n.isExpression(t))return n.visitEachChild(t,p,r.context);i.store.set(c,t),l&&i.store.set(l,n.factory.createNumericLiteral(t.kind));const a=r.transformFunction(s,!0);return 1===a.length&&a[0].kind===n.SyntaxKind.NullKeyword?n.visitEachChild(t,p,r.context):a};return n.visitNode(e,p)},preserveParams:!0},$$comptime:{call:([e],t,r)=>{if(t.config.noComptime)return;if(t.macroStack.length)throw new o.MacroError(r,"`comptime` macro cannot be called inside macros.");if(!e)throw new o.MacroError(r,"`comptime` macro expects a function as the first parameter.");const a=(0,o.normalizeFunctionNode)(t.checker,e);if(!a||!a.body)throw new o.MacroError(r,"`comptime` macro expects a function as the first parameter.");let i=r.parent;if(n.isExpressionStatement(i)&&(i=i.parent,n.isBlock(i)&&(i=i.parent),"body"in i)){const e=t.checker.getSignatureFromDeclaration(i);if(!e||!e.declaration)return;t.addComptimeSignature(e.declaration,(0,o.fnBodyToString)(t.checker,a,t.context.getCompilerOptions()),e.parameters.map((e=>e.name)))}else;},preserveParams:!0},$$raw:{call:([e],t,a)=>{if(t.config.noComptime)return;const i=t.getLastMacro();if(!i)throw new o.MacroError(a,"`raw` macro must be called inside another macro.");if(!e)throw new o.MacroError(a,"`raw` macro expects a function as the first parameter.");const s=(0,o.normalizeFunctionNode)(t.checker,e);if(!s||!s.body)throw new o.MacroError(a,"`raw` macro expects a function as the first parameter.");const c=[];for(const r of s.parameters.slice(1)){if(!n.isIdentifier(r.name))throw new o.MacroError(a,"`raw` macro parameters cannot be deconstructors.");c.push(r.name.text)}const l=t.addComptimeSignature(s,(0,o.fnBodyToString)(t.checker,s,t.context.getCompilerOptions()),["ctx",...c]);return(0,o.tryRun)(e,l,[{ts:n,factory:n.factory,transformer:t,checker:t.checker,thisMacro:i,require:r(1819),error:(e,t)=>{throw new o.MacroError(e,t)}},...(0,o.macroParamsToArray)(i.macro.params,[...i.args])],`$$raw in ${i.macro.name}: `)},preserveParams:!0}}},249:function(e,t,r){"use strict";var n=r(4250);Object.defineProperty(t,"__esModule",{value:!0}),t.MacroTransformer=void 0;const a=r(4625),i=r(5780),o=r(7914),s=r(4965);t.MacroTransformer=class{constructor(e,t,r,n,a){this.context=e,this.boundVisitor=this.visitor.bind(this),this.repeat=[],this.macroStack=[],this.escapedStatements=[],this.props={},this.checker=t,this.macros=r,this.comptimeSignatures=new Map,this.config=n||{},this.hooks=a||{}}run(e){var t,r;if(e.isDeclarationFile)return e;null===(r=(t=this.hooks).beforeFileTransform)||void 0===r||r.call(t,this,e);const n=[];this.addEscapeScope();for(const s of e.statements){if(a.isImportDeclaration(s)&&s.importClause&&!s.importClause.isTypeOnly){if(s.importClause.namedBindings&&a.isNamedImports(s.importClause.namedBindings)){const e=s.importClause.namedBindings.elements.filter((e=>{if(e.isTypeOnly)return this.config.keepImports;const t=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(e.name));return!t||!this.macros.has(t)&&!i.default[t.name]&&(!((0,o.hasBit)(t.flags,a.SymbolFlags.Interface)&&!(0,o.hasBit)(t.flags,a.SymbolFlags.Class)||(0,o.hasBit)(t.flags,a.SymbolFlags.ConstEnum)||(0,o.hasBit)(t.flags,a.SymbolFlags.TypeAlias))||this.config.keepImports)}));e.length&&n.push(a.factory.updateImportDeclaration(s,s.modifiers,a.factory.createImportClause(s.importClause.isTypeOnly,void 0,a.factory.createNamedImports(e)),s.moduleSpecifier,s.assertClause));continue}if(!s.importClause.namedBindings&&s.importClause.name){const e=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(s.importClause.name));e&&this.macros.has(e)||n.push(s);continue}}const e=this.visitor(s);this.saveAndClearEscapedStatements(n),e&&(Array.isArray(e)?n.push(...e):n.push(e))}return this.removeEscapeScope(),a.factory.updateSourceFile(e,n)}expectExpression(e){const t=a.visitNode(e,this.boundVisitor);if(!t||!a.isExpression(e))throw new o.MacroError(e,"Expected an expression.");return t}expectStatement(e){const t=a.visitNode(e,this.boundVisitor);if(!t||!a.isStatement(t))throw new o.MacroError(e,"Expected a statement.");return t}maybeStatement(e){if(!e)return;const t=a.visitNode(e,this.boundVisitor);if(t){if(!a.isStatement(t))throw new o.MacroError(e,"Expected a statement.");return t}}expect(e,t){const r=a.visitNode(e,this.boundVisitor);if(!r||r.kind!==t)throw new o.MacroError(e,`Expected SyntaxKind ${t}.`);return r}visitor(e){var t,r,i,c,l,p,u,f,d;if(a.isFunctionDeclaration(e)&&e.name&&!(null===(t=e.modifiers)||void 0===t?void 0:t.some((e=>e.kind===a.SyntaxKind.DeclareKeyword)))&&(0,o.isMacroIdent)(e.name)){if(!e.body)return e;const t=this.checker.getSymbolAtLocation(e.name);if(!t)return e;if(this.macros.has(t))return;const n=t.name,s=[];for(let r=0;r<e.parameters.length;r++){const t=e.parameters[r];if(!a.isIdentifier(t.name))throw new o.MacroError(t,"You cannot use deconstruction patterns in macros.");const n=this.getMarker(t);s.push({spread:Boolean(t.dotDotDotToken),marker:n,start:r,name:t.name.text,node:t,defaultVal:t.initializer||(t.questionToken?a.factory.createIdentifier("undefined"):void 0)})}const c={name:n,params:s,body:e.body,typeParams:e.typeParameters||[],node:e,namespace:a.isModuleBlock(e.parent)?e.parent.parent:void 0};return null===(i=(r=this.hooks).beforeRegisterMacro)||void 0===i||i.call(r,this,t,c),void this.macros.set(t,c)}if(a.isModuleDeclaration(e)&&e.body){const t=a.visitNode(e.body,this.boundVisitor);return t.statements.length?a.factory.updateModuleDeclaration(e,e.modifiers,e.name,t):void 0}if(a.isBlock(e)){const t=[];this.addEscapeScope();for(const r of e.statements){const e=this.visitor(r);this.saveAndClearEscapedStatements(t),e&&(Array.isArray(e)?t.push(...e):t.push(e))}return this.removeEscapeScope(),a.factory.updateBlock(e,t)}if(a.isLabeledStatement(e)){const t=this.findMacroByName(e.label,e.label.text);if(!t||!t.body)return;let r=e.statement;const n=[];if(a.isLabeledStatement(r)){const t=this.visitor(e.statement);if(!t)return e;if(Array.isArray(t)){const a=t.findIndex((e=>s.labelActions[e.kind]));if(-1===a)return e;n.push(...t.filter(((e,t)=>t!==a))),r=t[a]}else r=this.expectStatement(e.statement)}const i=s.labelActions[r.kind];if(!i)return e;this.macroStack.push({macro:t,call:void 0,args:a.factory.createNodeArray([i(r)]),defined:new Map,store:new Map}),n.push(...a.visitEachChild(t.body,this.boundVisitor,this.context).statements);const o=t.params.find((e=>1===e.marker));return o&&(o.defaultVal=a.factory.createNumericLiteral(+o.defaultVal.text+1)),this.macroStack.pop(),n}if(a.isExpressionStatement(e)){if(a.isCallExpression(e.expression)&&a.isNonNullExpression(e.expression.expression)){const t=this.runMacroFromCallExpression(e.expression,e.expression.expression.expression);return t?this.expandMacroResults(t,e.parent):e}if(a.isTaggedTemplateExpression(e.expression)&&a.isNonNullExpression(e.expression.tag)){const t=this.runMacroFromTemplateExpression(e.expression,e.expression.tag.expression);return t?this.expandMacroResults(t,e.parent):e}}if(a.canHaveDecorators(e)&&(null===(c=a.getDecorators(e))||void 0===c?void 0:c.length)){const t=a.getDecorators(e);let r;const n=[];for(let e=t.length-1;e>=0;e--){const i=t[e];if(a.isCallExpression(i.expression)&&a.isNonNullExpression(i.expression.expression)){const e=this.runMacroFromCallExpression(i.expression,i.expression.expression.expression,r||i.parent);if(e&&e.length){const[t,i]=(0,o.deExpandMacroResults)(e);i&&(r=a.visitNode(i,this.boundVisitor)),n.push(...t)}}}if(r)return[...n,r]}if(a.isCallExpression(e)){if(a.isNonNullExpression(e.expression)){const t=this.runMacroFromCallExpression(e,e.expression.expression);return t?t.length?this.expandMacroResults(t):a.factory.createNull():e}this.callComptimeFunction(e)}if(a.isTaggedTemplateExpression(e)&&a.isNonNullExpression(e.tag)){const t=this.runMacroFromTemplateExpression(e,e.tag.expression);return t&&t.length?this.expandMacroResults(t):a.factory.createNull()}if(a.isNewExpression(e)&&this.callComptimeFunction(e),this.macroStack.length){const{macro:t,args:r,store:i}=this.getLastMacro();if(a.isPropertyAccessExpression(e)||a.isElementAccessExpression(e)){if(this.props.optimizeEnv&&a.isPropertyAccessExpression(e)&&"process.env"===e.expression.getText()){const t=n.env[e.name.text];return t?a.factory.createStringLiteral(t):e}{let t=this.expectExpression(e.expression);for(;a.isParenthesizedExpression(t);)t=t.expression;if(a.isObjectLiteralExpression(t)){const r=a.isPropertyAccessExpression(e)?(0,o.getNameFromProperty)(e.name):this.getNumberFromNode(this.expectExpression(e.argumentExpression));if(!r)return e;const n=t.properties.find((e=>e.name&&(0,o.getNameFromProperty)(e.name)===r));return n?a.isPropertyAssignment(n)?n.initializer:a.factory.createPropertyAccessExpression(t,r.toString()):a.factory.createNull()}if(a.isArrayLiteralExpression(t)){if(!a.isElementAccessExpression(e))return a.factory.createPropertyAccessExpression(t,e.name);const r=this.expectExpression(e.argumentExpression),n=this.getNumberFromNode(r);return void 0!==n&&t.elements[n]?t.elements[n]:a.factory.createElementAccessExpression(t,r)}}}else{if(a.isAsExpression(e))return a.visitNode(e.expression,this.boundVisitor);if(a.isNonNullExpression(e))return a.visitNode(e.expression,this.boundVisitor);if(a.isNumericLiteral(e))return a.factory.createNumericLiteral(e.text);if(a.isStringLiteral(e))return a.factory.createStringLiteral(e.text);if(a.isRegularExpressionLiteral(e))return a.factory.createRegularExpressionLiteral(e.text);if(a.isTemplateHead(e))return a.factory.createTemplateHead(e.text,e.rawText,e.templateFlags);if(a.isTemplateMiddle(e))return a.factory.createTemplateMiddle(e.text,e.rawText,e.templateFlags);if(a.isTemplateTail(e))return a.factory.createTemplateTail(e.text,e.rawText,e.templateFlags);if(a.isIdentifier(e)){if(i.has(e.text)){const t=i.get(e.text);return a.isStringLiteral(t)&&(a.isDeclaration(e.parent)||a.isPropertyAccessExpression(e.parent))?a.factory.createIdentifier(e.text):t}const n=this.getMacroParam(e.text,t,r);return n?a.isIdentifier(n)?n:a.visitNode(n,this.boundVisitor):e}if(a.isVariableStatement(e)){const t=[];for(const r of e.declarationList.declarations)a.isIdentifier(r.name)&&r.name.text.startsWith("$")?i.set(r.name.text,r.initializer?this.expectExpression(r.initializer):a.factory.createIdentifier("undefined")):t.push(this.expect(r,a.SyntaxKind.VariableDeclaration));return t.length?a.factory.createVariableStatement(e.modifiers,a.factory.createVariableDeclarationList(t,e.declarationList.flags)):void 0}if(a.isArrayLiteralExpression(e)&&e.elements.some((e=>a.isSpreadElement(e)))){const t=[];for(const r of e.elements)if(a.isSpreadElement(r)){const e=this.expectExpression(r.expression);a.isArrayLiteralExpression(e)?t.push(...e.elements):t.push(this.expectExpression(r))}else t.push(this.expectExpression(r));return a.factory.createArrayLiteralExpression(t)}if(a.isConditionalExpression(e)){const t=this.expectExpression(e.condition),r=this.getBoolFromNode(t);return!1===r?a.visitNode(e.whenFalse,this.boundVisitor):!0===r?a.visitNode(e.whenTrue,this.boundVisitor):a.factory.createConditionalExpression(t,void 0,this.expectExpression(e.whenTrue),void 0,this.expectExpression(e.whenFalse))}if(a.isIfStatement(e)&&!a.isParenthesizedExpression(e.expression)){const t=this.expectExpression(e.expression),r=this.getBoolFromNode(t);if(!0===r){const t=this.expectStatement(e.thenStatement);return t&&a.isBlock(t)?[...t.statements]:t}if(!1===r){if(!e.elseStatement)return;const t=this.maybeStatement(e.elseStatement);return t&&a.isBlock(t)?[...t.statements]:t}return a.factory.createIfStatement(t,this.expectStatement(e.thenStatement),e.elseStatement?this.expectStatement(e.elseStatement):void 0)}if(a.isBinaryExpression(e)){const t=e.operatorToken.kind,r=this.expectExpression(e.right);if(t===a.SyntaxKind.EqualsToken&&a.isIdentifier(e.left)&&i.has(e.left.text))return void i.set(e.left.text,r);const n=this.expectExpression(e.left),c=this.getLiteralFromNode(n),d=this.getLiteralFromNode(r);return c===o.NO_LIT_FOUND||d===o.NO_LIT_FOUND?null!==(p=null===(l=s.possiblyUnknownValueBinaryActions[t])||void 0===l?void 0:l.call(s.possiblyUnknownValueBinaryActions,n,r,c,d))&&void 0!==p?p:a.factory.createBinaryExpression(n,t,r):s.binaryNumberActions[t]&&"number"===typeof c&&"number"===typeof d?s.binaryNumberActions[t](c,d):null!==(f=null===(u=s.binaryActions[t])||void 0===u?void 0:u.call(s.binaryActions,n,r,c,d))&&void 0!==f?f:a.factory.createBinaryExpression(n,t,r)}if(a.isTypeOfExpression(e)){const t=this.expectExpression(e.expression),r=this.getLiteralFromNode(t);return r===o.NO_LIT_FOUND?a.factory.updateTypeOfExpression(e,t):a.factory.createStringLiteral(typeof r)}if(a.isExpressionStatement(e)&&a.isPrefixUnaryExpression(e.expression)&&e.expression.operator===a.SyntaxKind.PlusToken&&a.isArrayLiteralExpression(e.expression.operand))return this.execRepetition((0,o.getRepetitionParams)(this.checker,e.expression.operand));if(a.isPrefixUnaryExpression(e)){if(e.operator===a.SyntaxKind.PlusToken&&a.isArrayLiteralExpression(e.operand)){const t=(0,o.getRepetitionParams)(this.checker,e.operand);if(!t.separator)throw new o.MacroError(e,"Repetition separator must be included if a repetition is used as an expression.");return this.execRepetition(t,!0)}{const t=e.operator,r=this.expectExpression(e.operand),n=this.getLiteralFromNode(r);return n===o.NO_LIT_FOUND?a.factory.createPrefixUnaryExpression(e.operator,r):(null===(d=s.unaryActions[t])||void 0===d?void 0:d.call(s.unaryActions,n))||r}}if(a.isCallExpression(e)){const t=e.arguments.findIndex((e=>a.isPrefixUnaryExpression(e)&&e.operator===a.SyntaxKind.PlusToken&&a.isArrayLiteralExpression(e.operand)));if(-1!==t){const r=e.arguments[t].operand,n=(0,o.getRepetitionParams)(this.checker,r);if(!n.separator){const r=this.execRepetition(n,!0),i=[];for(let n=0;n<e.arguments.length;n++)n===t?i.push(...r):i.push(e.arguments[n]);return a.visitNode(a.factory.createCallExpression(e.expression,e.typeArguments,i),this.boundVisitor)}}}}return a.visitEachChild(e,this.boundVisitor,this.context)}return a.visitEachChild(e,this.boundVisitor,this.context)}execRepetition({fn:e,literals:t,separator:r,indexTypes:n},i){const o=[],s=e.parameters.map((e=>e.name.getText())),l=Array.from({length:s.length},(()=>[]));let p=0;for(let c=0;c<t.length;c++){const e=t[c],r=this.expectExpression(e);a.isArrayLiteralExpression(r)&&(r.elements.length>p&&(p=r.elements.length),l[c%s.length].push(...r.elements))}if(!p)return[a.factory.createNull()];const u=this.repeat.push({index:0,elementSlices:l,repeatNames:s,indexTypes:n})-1;for(;this.repeat[u].index<p;this.repeat[u].index++)o.push(...this.transformFunction(e,i));return this.repeat.pop(),r&&c[r]?[c[r](this,o)]:o}transformFunction(e,t){if(!e.body)return[];const r=[];if("statements"in e.body)if(t)r.push((0,o.wrapExpressions)(e.body.statements.map((e=>this.maybeStatement(e))).filter((e=>e))));else for(const n of e.body.statements){const e=a.visitNode(n,this.boundVisitor);e&&(Array.isArray(e)?r.push(...e):r.push(e))}else{const t=this.expectExpression(e.body);r.push(t)}return r}getMacroParam(e,t,r){const n=t.params.findIndex((t=>t.name===e));if(-1===n){for(let t=this.repeat.length-1;t>=0;t--){const r=this.repeat[t],n=r.repeatNames.indexOf(e);if(-1!==n){const e=r.elementSlices[n];return e.length<=r.index?a.factory.createNull():e[r.index]}}return}const i=t.params[n];if(i.realName)return i.realName;if(i.spread){const e=r.slice(i.start);return 1===e.length&&a.isSpreadElement(e[0])?e[0].expression:a.factory.createArrayLiteralExpression(r.slice(i.start))}return r[i.start]||i.defaultVal}runMacroFromTemplateExpression(e,t){const r=this.macros.get((0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t)));if(!r||!a.isTemplateExpression(e.template))return;const n=[a.factory.createStringLiteral(e.template.head.text)],i=[];for(const o of e.template.templateSpans)i.push(this.expectExpression(o.expression)),n.push(a.factory.createStringLiteral(o.literal.text));return this.execMacro(r,a.factory.createNodeArray([a.factory.createArrayLiteralExpression(n),...i]),e)}runMacroFromCallExpression(e,t,r){var n;const s=e.arguments;let c,l;if(a.isPropertyAccessExpression(t)){if(!(0,o.isMacroIdent)(t.name))return;const r=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t.expression));if(r&&(0,o.hasBit)(r.flags,a.SymbolFlags.Namespace))return this.runMacroFromCallExpression(e,t.name);const n=this.findMacroByTypeParams(t,e);if(!n.length)throw new o.MacroError(e,`No possible candidates for "${t.name.getText()}" call`);if(n.length>1)throw new o.MacroError(e,`More than one possible candidate for "${t.name.getText()}" call`);c=n[0];const i=a.factory.createNodeArray([this.expectExpression(t.expression),...e.arguments]);l=this.macroStack.length?a.factory.createNodeArray(i.map((e=>this.expectExpression(e)))):i}else if(a.isIdentifier(t)){if(!(0,o.isMacroIdent)(t))return;const r=i.default[t.text];if(r){const t=r.call(r.preserveParams?s:a.factory.createNodeArray(s.map((e=>this.expectExpression(e)))),this,e);return t?Array.isArray(t)?t:a.isStatement(t)?[t]:[a.factory.createExpressionStatement(t)]:[]}c=this.macros.get((0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t))),l=this.macroStack.length?a.factory.createNodeArray(s.map((e=>this.expectExpression(e)))):s}if(!c||!c.body){const a=(0,o.resolveAliasedSymbol)(this.checker,this.checker.getSymbolAtLocation(t));return(null===(n=null===a||void 0===a?void 0:a.declarations)||void 0===n?void 0:n.length)&&!this.boundVisitor(a.declarations[0])?this.runMacroFromCallExpression(e,t,r):void 0}return this.execMacro(c,l||a.factory.createNodeArray(),e,r)}execMacro(e,t,r,n){var i,o;const s={macro:e,args:t,call:r,target:n,defined:new Map,store:new Map};null===(o=(i=this.hooks).beforeCallMacro)||void 0===o||o.call(i,this,e,s),this.macroStack.push(s);const c=[];for(let u=0;u<e.params.length;u++){const r=e.params[u];if(2===r.marker){const e=r.spread?a.factory.createArrayLiteralExpression(t.slice(r.start)):t[r.start]||r.defaultVal;a.isIdentifier(e)||(r.realName=a.factory.createUniqueName(r.name),c.push(a.factory.createVariableDeclaration(r.realName,void 0,void 0,e)))}}c.length&&this.escapeStatement(a.factory.createVariableStatement(void 0,a.factory.createVariableDeclarationList(c,a.NodeFlags.Let)));const l=a.visitEachChild(e.body,this.boundVisitor,this.context).statements,p=e.params.find((e=>1===e.marker));return p&&(p.defaultVal=a.factory.createNumericLiteral(+p.defaultVal.text+1)),this.macroStack.pop(),[...l]}expandMacroResults(e,t){if(t){const r=this.makeHygienic(e);if(r.length&&a.isReturnStatement(r[r.length-1])&&a.isSourceFile(t)){const e=r.pop();e.expression&&r.push(a.factory.createExpressionStatement(e.expression))}return r}{let t=e.pop();if(0===e.length){if(a.isReturnStatement(t)||a.isExpressionStatement(t))return t.expression;if(!a.isStatement(t))return t}return a.isExpressionStatement(t)?t=a.factory.createReturnStatement(t.expression):a.isStatement(t)||(t=a.factory.createReturnStatement(t)),a.factory.createCallExpression(a.factory.createParenthesizedExpression(a.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,a.factory.createBlock([...e,t],!0))),void 0,void 0)}}makeHygienic(e){var t;const r=(null===(t=this.getLastMacro())||void 0===t?void 0:t.defined)||new Map,n=e=>{if(a.isIdentifier(e)){const t=a.factory.createUniqueName(e.text);return r.set(e.text,t),t}return a.isArrayBindingPattern(e)?a.factory.createArrayBindingPattern(e.elements.map((e=>a.isBindingElement(e)?a.factory.createBindingElement(e.dotDotDotToken,e.propertyName,n(e.name),e.initializer?this.expectExpression(e.initializer):void 0):e))):a.isObjectBindingPattern(e)?a.factory.createObjectBindingPattern(e.elements.map((e=>a.factory.createBindingElement(e.dotDotDotToken,e.propertyName,n(e.name),e.initializer?this.expectExpression(e.initializer):void 0)))):e},i=e=>a.isVariableDeclaration(e)&&-1!==e.pos?a.factory.updateVariableDeclaration(e,n(e.name),void 0,void 0,e.initializer?i(this.expectExpression(e.initializer)):void 0):a.isIdentifier(e)?e.parent&&a.isPropertyAccessExpression(e.parent)&&e.parent.expression!==e?e:r.get(e.text)||e:a.visitEachChild(e,i,this.context);return e.map((e=>i(e)))}getMarker(e){if(!e.type)return 0;const t=this.checker.getTypeAtLocation(e.type).getProperty("__marker");if(!t)return 0;const r=this.checker.getTypeOfSymbol(t).getNonNullableType();if(!r.isStringLiteral())return 0;switch(r.value){case"Accumulator":return 1;case"Save":return 2;default:return 0}}callComptimeFunction(e){var t;if(this.comptimeSignatures.size){const r=this.checker.getResolvedSignature(e);if(r&&r.declaration){const n=this.comptimeSignatures.get(r.declaration);n&&(0,o.tryRun)(e,n,(null===(t=e.arguments)||void 0===t?void 0:t.map((e=>{const t=this.getLiteralFromNode(e,!1,!0,!0);return t===o.NO_LIT_FOUND?void 0:t})))||[])}}}getNumberFromNode(e){if(a.isParenthesizedExpression(e))return this.getNumberFromNode(e.expression);if(a.isNumericLiteral(e))return+e.text;const t=this.checker.getTypeAtLocation(e);return t.isNumberLiteral()?t.value:"null"===t.intrinsicName?0:void 0}getStringFromNode(e,t=!1,r=!1){if(!e)return;const n=this.getLiteralFromNode(e,t,r);return"string"===typeof n?n:void 0}getLiteralFromNode(e,t=!1,r=!1,n=!1){if(a.isParenthesizedExpression(e))return this.getLiteralFromNode(e.expression);if(a.isAsExpression(e))return this.getLiteralFromNode(e.expression);if(a.isNumericLiteral(e))return+e.text;if(a.isStringLiteral(e))return e.text;if(e.kind===a.SyntaxKind.FalseKeyword)return!1;if(e.kind===a.SyntaxKind.TrueKeyword)return!0;if(e.kind===a.SyntaxKind.NullKeyword)return null;if(a.isIdentifier(e)){if("undefined"===e.text)return;if(t)return e.text}else{if(r&&a.isTemplateExpression(e)){let t=e.head.text;for(const r of e.templateSpans){t+=(this.getLiteralFromNode(this.expectExpression(r.expression))||"").toString()+r.literal.text}return t}if(n&&a.isObjectLiteralExpression(e)){const i={};for(const s of e.properties){if(!a.isPropertyAssignment(s)||!s.initializer)continue;const e=s.name&&(0,o.getNameFromProperty)(s.name);e&&(i[e]=this.getLiteralFromNode(s.initializer,t,r,n))}return i}if(n&&a.isArrayLiteralExpression(e))return e.elements.map((e=>this.getLiteralFromNode(e,t,r,n)))}const i=this.checker.getTypeAtLocation(e);return i.isNumberLiteral()||i.isStringLiteral()||i.value?i.value:"false"!==i.intrinsicName&&("true"===i.intrinsicName||("undefined"===i.intrinsicName?void 0:"null"===i.intrinsicName?null:o.NO_LIT_FOUND))}getBoolFromNode(e){if(!e)return;if(e.kind===a.SyntaxKind.FalseKeyword||e.kind===a.SyntaxKind.NullKeyword)return!1;if(e.kind===a.SyntaxKind.TrueKeyword)return!0;if(a.isNumericLiteral(e))return"0"!==e.text;if(a.isStringLiteral(e))return""!==e.text;if(a.isArrayLiteralExpression(e)||a.isObjectLiteralElement(e))return!0;if(a.isIdentifier(e)&&"undefined"===e.text)return!1;const t=this.checker.getTypeAtLocation(e);return t.isNumberLiteral()?0!==t.value:t.isStringLiteral()?""!==t.value:!!t.getCallSignatures().length||"false"!==t.intrinsicName&&("true"===t.intrinsicName||"undefined"!==t.intrinsicName&&("null"!==t.intrinsicName&&void 0))}resolveTypeArgumentOfCall(e,t){var r,n;if(!e.typeArguments||!e.typeArguments[t])return;const i=this.checker.getTypeAtLocation(e.typeArguments[t]),s=this.getLastMacro();if(!s)return i;const c=this.repeat[this.repeat.length-1];if(!i.isTypeParameter()){const e=s.macro.typeParams.map((e=>this.checker.getTypeAtLocation(e))),t=(0,o.resolveTypeArguments)(this.checker,s.call);if(c&&c.indexTypes){e.push(...c.indexTypes);for(let e=0;e<c.repeatNames.length;e++){const r=c.elementSlices[e][c.index];r&&t.push((0,o.getTypeAtLocation)(this.checker,r))}}return(0,o.resolveTypeWithTypeParams)(i,e,t)}{if(c&&c.indexTypes){const e=c.indexTypes.findIndex((e=>e===i));if(-1!==e){const t=null===(r=c.elementSlices[e])||void 0===r?void 0:r[c.index];if(!t)return;return(0,o.getTypeAtLocation)(this.checker,t)}}const e=s.macro.typeParams.findIndex((e=>this.checker.getTypeAtLocation(e)===i));if(-1!==e&&s.call&&a.isCallExpression(s.call)){const t=null===(n=s.call.typeArguments)||void 0===n?void 0:n[e];return t?(0,o.getTypeAtLocation)(this.checker,t):(0,o.resolveTypeArguments)(this.checker,s.call)[e]}}}findMacroByTypeParams(e,t){const r=e.name.getText(),n=this.checker.getTypeAtLocation(e.expression),a=t.arguments.map((e=>this.checker.getTypeAtLocation(e))),i=[];e:for(const[s,c]of this.macros){if(c.name!==r)continue;const e=this.checker.getTypeOfSymbolAtLocation(s,s.valueDeclaration).getCallSignatures()[0],t=c.typeParams.map((e=>this.checker.getTypeAtLocation(e))),l=t.map((e=>e.getConstraint()||this.checker.getAnyType())),p=t.length?e.parameters.map((e=>(0,o.resolveTypeWithTypeParams)(this.checker.getTypeOfSymbolAtLocation(e,e.valueDeclaration),t,l))):e.parameters.map((e=>this.checker.getTypeOfSymbolAtLocation(e,e.valueDeclaration))),u=p.shift();if(this.checker.isTypeAssignableTo(n,u)){for(let e=0;e<p.length&&!c.params[e+1].spread;e++){if(!a[e]){if(p[e].getDefault()||p[e]!==p[e].getNonNullableType())continue;continue e}if(!this.checker.isTypeAssignableTo(a[e],p[e]))continue e}if(a.length>p.length){let e=this.checker.getTypeArguments(p[p.length-1])[0];if(e.isTypeParameter()&&(e=e.getConstraint()||this.checker.getAnyType()),!c.params[c.params.length-1].spread)continue;for(let t=p.length-1;t<a.length;t++)if(!this.checker.isTypeAssignableTo(a[t],e))continue e}i.push(c)}}return i}findMacroByName(e,t){const r=[];for(const[,n]of this.macros)n.name===t&&r.push(n);if(r.length>1)throw new o.MacroError(e,`More than one macro with the name ${t} exists.`);return r[0]}getLastMacro(){return this.macroStack[this.macroStack.length-1]}saveAndClearEscapedStatements(e){e.push(...this.escapedStatements[this.escapedStatements.length-1]),this.escapedStatements[this.escapedStatements.length-1].length=0}escapeStatement(...e){this.escapedStatements[this.escapedStatements.length-1].push(...e)}removeEscapeScope(){this.escapedStatements.pop()}addEscapeScope(){this.escapedStatements.push([])}addComptimeSignature(e,t,r){if(this.comptimeSignatures.has(e))return this.comptimeSignatures.get(e);const n=new Function(...r,t);return this.comptimeSignatures.set(e,n),n}strToAST(e){const t=a.createSourceFile("",e,a.ScriptTarget.ESNext,!0,a.ScriptKind.TSX),r=e=>a.factory.cloneNode(a.visitEachChild(e,r,this.context));return a.visitEachChild(t,r,this.context).statements}getIdent(e){const t=this.getLastMacro();return t&&t.defined.get(e)||a.factory.createIdentifier(e)}toNode(e){return(0,o.primitiveToNode)(e)}cleanupMacros(e,t){for(const[r,n]of this.macros)if(e.name===n.name&&e.node.getSourceFile().fileName===n.node.getSourceFile().fileName&&e.namespace===n.namespace){this.macros.delete(r),null===t||void 0===t||t(n);break}}};const c={"[]":(e,t)=>a.factory.createArrayLiteralExpression(t.map((e=>a.isExpressionStatement(e)?e.expression:e))),"+":(e,t)=>(0,o.toBinaryExp)(e,t,a.SyntaxKind.PlusToken),"-":(e,t)=>(0,o.toBinaryExp)(e,t,a.SyntaxKind.MinusToken),"*":(e,t)=>(0,o.toBinaryExp)(e,t,a.SyntaxKind.AsteriskToken),"||":(e,t)=>(0,o.toBinaryExp)(e,t,a.SyntaxKind.BarBarToken),"&&":(e,t)=>(0,o.toBinaryExp)(e,t,a.SyntaxKind.AmpersandAmpersandToken),"()":(e,t)=>a.factory.createParenthesizedExpression((0,o.toBinaryExp)(e,t,a.SyntaxKind.CommaToken)),".":(e,t)=>{let r=t[0];for(let n=1;n<t.length;n++){const e=t[n];r=a.isIdentifier(e)?a.factory.createPropertyAccessExpression(r,e):a.factory.createElementAccessExpression(r,e)}return r},"{}":(e,t)=>a.factory.createObjectLiteralExpression(t.filter((e=>a.isArrayLiteralExpression(e))).map((t=>{const r=t;if(r.elements.length<2)return a.factory.createPropertyAssignment("undefined",a.factory.createIdentifier("undefined"));const n=e.getStringFromNode(r.elements[0],!1,!0);return n?a.factory.createPropertyAssignment(n,r.elements[1]):a.factory.createPropertyAssignment("undefined",a.factory.createIdentifier("undefined"))})))}},7427:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateChainingTypings=void 0;const n=r(4625),a=r(7914),i=r(3931);function o(e,t){return(0,a.hasBit)(t.flags,n.TypeFlags.String)?"String":(0,a.hasBit)(t.flags,n.TypeFlags.Number)?"Number":(0,a.hasBit)(t.flags,n.TypeFlags.Boolean)?"Boolean":e.isArrayType(t)||e.isTupleType(t)?"Array":void 0}t.generateChainingTypings=function(e,t){var r,s,c;const l=new a.MapArray;for(const[,a]of t){const t=null===(r=a.params[0])||void 0===r?void 0:r.node;if(!t)continue;const o=e.getTypeAtLocation(t);if(!o)continue;const s=n.factory.createMethodSignature([],a.name,a.node.questionToken,a.node.typeParameters,a.node.parameters.slice(1),a.node.type||i.UNKNOWN_TOKEN);if(o.isUnion())for(const e of o.types)l.push(e,s);else l.push(o,s)}const p=[];for(const[a,i]of l){const t=o(e,a);t&&p.push(n.factory.createInterfaceDeclaration(void 0,t,null===(c=null===(s=a.target)||void 0===s?void 0:s.typeParameters)||void 0===c?void 0:c.map((e=>n.factory.createTypeReferenceNode(n.factory.createIdentifier(e.symbol.name),void 0))),void 0,i))}return[n.factory.createModuleDeclaration([n.factory.createToken(n.SyntaxKind.DeclareKeyword)],n.factory.createIdentifier("global"),n.factory.createModuleBlock(p),n.NodeFlags.ExportContext|n.NodeFlags.GlobalAugmentation|n.NodeFlags.Ambient|n.NodeFlags.ContextFlags)]}},3931:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformDeclaration=t.UNKNOWN_TOKEN=void 0;const n=r(4625);t.UNKNOWN_TOKEN=n.factory.createKeywordTypeNode(n.SyntaxKind.UnknownKeyword),t.transformDeclaration=function(e,r){if(n.isInterfaceDeclaration(r)||n.isTypeAliasDeclaration(r)||n.isEnumDeclaration(r))return r;if(n.isClassDeclaration(r))return n.factory.createClassDeclaration([...r.modifiers||[],n.factory.createToken(n.SyntaxKind.DeclareKeyword)],r.name,r.typeParameters,r.heritageClauses,r.members.map((e=>n.isMethodDeclaration(e)?n.factory.createMethodDeclaration(e.modifiers,e.asteriskToken,e.name,e.questionToken,e.typeParameters,e.parameters,e.type||t.UNKNOWN_TOKEN,void 0):n.isPropertyDeclaration(e)?n.factory.createPropertyDeclaration(e.modifiers,e.name,e.questionToken||e.exclamationToken,e.type||t.UNKNOWN_TOKEN,void 0):n.isGetAccessorDeclaration(e)?n.factory.createGetAccessorDeclaration(e.modifiers,e.name,e.parameters,e.type||t.UNKNOWN_TOKEN,void 0):n.isSetAccessorDeclaration(e)?n.factory.createSetAccessorDeclaration(e.modifiers,e.name,e.parameters,void 0):n.isConstructorDeclaration(e)?n.factory.createConstructorDeclaration(e.modifiers,e.parameters,void 0):e)));if(n.isExpressionStatement(r)&&n.isClassExpression(r.expression))return n.factory.createClassDeclaration([...r.expression.modifiers||[],n.factory.createToken(n.SyntaxKind.DeclareKeyword)],r.expression.name,r.expression.typeParameters,r.expression.heritageClauses,r.expression.members.map((e=>n.isMethodDeclaration(e)?n.factory.createMethodDeclaration(e.modifiers,e.asteriskToken,e.name,e.questionToken,e.typeParameters,e.parameters,e.type||t.UNKNOWN_TOKEN,void 0):n.isPropertyDeclaration(e)?n.factory.createPropertyDeclaration(e.modifiers,e.name,e.questionToken||e.exclamationToken,e.type||t.UNKNOWN_TOKEN,void 0):n.isGetAccessorDeclaration(e)?n.factory.createGetAccessorDeclaration(e.modifiers,e.name,e.parameters,e.type||t.UNKNOWN_TOKEN,void 0):n.isSetAccessorDeclaration(e)?n.factory.createSetAccessorDeclaration(e.modifiers,e.name,e.parameters,void 0):n.isConstructorDeclaration(e)?n.factory.createConstructorDeclaration(e.modifiers,e.parameters,void 0):e)));if(n.isVariableStatement(r)){const t=[];for(const a of r.declarationList.declarations){let r;if(a.initializer){const t=e.getTypeAtLocation(a.initializer),n=e.typeToTypeNode(t,void 0,void 0);n&&(r=n)}t.push(n.factory.createVariableDeclaration(a.name,a.exclamationToken,r))}return n.factory.createVariableStatement([...r.modifiers||[],n.factory.createToken(n.SyntaxKind.DeclareKeyword)],t)}return n.isFunctionDeclaration(r)?n.factory.createFunctionDeclaration([...r.modifiers||[],n.factory.createToken(n.SyntaxKind.DeclareKeyword)],r.asteriskToken,r.name,r.typeParameters,r.parameters,r.type||t.UNKNOWN_TOKEN,void 0):void 0}},6369:function(e,t,r){"use strict";var n=r(818);t.QM=void 0;const a=r(4625),i=r(249),o=r(3349),s=r(3931),c=r(7914),l=r(7427);function p(e,t,r){let n="";for(const i of t)n+=e.printNode(a.EmitHint.Unspecified,i,r);return n}function u(e,t,r,n){const a=e||n.createCompilerHost(t||n.getDefaultCompilerOptions(),!0),i=a.getSourceFile;return Object.assign(Object.assign({},a),{getSourceFile:(e,t,n,a)=>r.has(e)?r.get(e):i(e,t,n,a)})}t.QM=function(e,t){const r=[];for(const a of t.statements)if(-1===a.pos){const t=(0,s.transformDeclaration)(e,a);t&&r.push(t)}const n=a.createPrinter();return{typeNodes:r,chainTypes:(0,l.generateChainingTypings)(e,o.macros),print:e=>p(n,e,t)}}},7914:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapArray=t.getGeneralType=t.getTypeAtLocation=t.expressionToStringLiteral=t.normalizeFunctionNode=t.deExpandMacroResults=t.resolveTypeArguments=t.resolveTypeWithTypeParams=t.macroParamsToArray=t.tryRun=t.fnBodyToString=t.resolveAliasedSymbol=t.primitiveToNode=t.createObjectLiteral=t.getNameFromProperty=t.genDiagnosticFromMacroError=t.MacroError=t.getRepetitionParams=t.toBinaryExp=t.wrapExpressions=t.hasBit=t.isMacroIdent=t.flattenBody=t.NO_LIT_FOUND=void 0;const n=r(4625);function a(e){return"statements"in e?[...e.statements]:[n.factory.createExpressionStatement(e)]}function i(e,t){return 0!==(e&t)}t.NO_LIT_FOUND=Symbol("NO_LIT_FOUND"),t.flattenBody=a,t.isMacroIdent=function(e){return"$"===e.text[0]},t.hasBit=i,t.wrapExpressions=function(e){let t=e.pop();return t?0===e.length&&n.isReturnStatement(t)?t.expression||n.factory.createIdentifier("undefined"):(n.isExpressionStatement(t)?t=n.factory.createReturnStatement(t.expression):t.kind>n.SyntaxKind.EmptyStatement&&t.kind<n.SyntaxKind.DebuggerStatement||(t=n.factory.createReturnStatement(t)),n.factory.createImmediatelyInvokedArrowFunction([...e,t])):n.factory.createNull()},t.toBinaryExp=function(e,t,r){let a;for(const i of t.map((e=>n.isExpressionStatement(e)?e.expression:e)))a=a?e.context.factory.createBinaryExpression(a,r,i):i;return n.visitNode(a,e.boundVisitor)},t.getRepetitionParams=function(e,t){const r={literals:[]},a=t.elements[0];n.isStringLiteral(a)?r.separator=a.text:n.isArrayLiteralExpression(a)?r.literals.push(...a.elements):n.isArrowFunction(a)&&(r.fn=a);const i=t.elements[1];i&&(n.isArrayLiteralExpression(i)?r.literals.push(...i.elements):n.isArrowFunction(i)&&(r.fn=i));const s=t.elements[2];if(s&&n.isArrowFunction(s)&&(r.fn=s),!r.fn)throw new o(t,"Repetition must include arrow function.");return r.indexTypes=(r.fn.typeParameters||[]).map((t=>e.getTypeAtLocation(t))),r};class o extends Error{constructor(e,t){const r=e.pos,a=e.end-e.pos;super(n.formatDiagnosticsWithColorAndContext([{category:n.DiagnosticCategory.Error,code:8e3,file:e.getSourceFile(),start:r,length:a,messageText:t}],{getNewLine:()=>"\r\n",getCurrentDirectory:()=>"unknown directory",getCanonicalFileName:e=>e})),this.start=r,this.length=a,this.rawMsg=t}}t.MacroError=o,t.genDiagnosticFromMacroError=function(e,t){return{code:8e3,start:t.start,length:t.length,messageText:t.rawMsg,file:e,category:n.DiagnosticCategory.Error}},t.getNameFromProperty=function(e){return n.isIdentifier(e)||n.isStringLiteral(e)||n.isPrivateIdentifier(e)||n.isNumericLiteral(e)?e.text:void 0},t.createObjectLiteral=function(e){const t=[];for(const r in e){const a=e[r];t.push(n.factory.createPropertyAssignment(r,a?n.isStatement(a)?n.factory.createArrowFunction(void 0,void 0,[],void 0,void 0,n.isBlock(a)?a:n.factory.createBlock([a])):a:n.factory.createIdentifier("undefined")))}return n.factory.createObjectLiteralExpression(t)},t.primitiveToNode=function e(t){if(null===t)return n.factory.createNull();if(void 0===t)return n.factory.createIdentifier("undefined");if("string"===typeof t)return n.factory.createStringLiteral(t);if("number"===typeof t)return n.factory.createNumericLiteral(t);if("boolean"===typeof t)return t?n.factory.createTrue():n.factory.createFalse();if(Array.isArray(t))return n.factory.createArrayLiteralExpression(t.map((t=>e(t))));{const r=[];for(const a in t)r.push(n.factory.createPropertyAssignment(n.factory.createStringLiteral(a),e(t[a])));return n.factory.createObjectLiteralExpression(r)}},t.resolveAliasedSymbol=function(e,t){if(t){for(;0!==(t.flags&n.SymbolFlags.Alias);){const r=e.getAliasedSymbol(t);if("unknown"===r.name)return t;t=r}return t}},t.fnBodyToString=function e(t,r,a){if(!r.body)return"";const i=new Set;let o="";const s=c=>{if(n.isCallExpression(c)){const l=t.getResolvedSignature(c);if(l&&l.declaration&&l.declaration!==r&&l.declaration.parent.parent!==r&&(n.isFunctionDeclaration(l.declaration)||n.isArrowFunction(l.declaration)||n.isFunctionExpression(l.declaration))){const r=l.declaration.name?l.declaration.name.text:n.isIdentifier(c.expression)?c.expression.text:void 0;if(!r||i.has(r))return;i.add(r),o+=`function ${r}(${l.parameters.map((e=>e.name)).join(",")}){${e(t,l.declaration,a)}}`}n.forEachChild(c,s)}else n.forEachChild(c,s)};return n.forEachChild(r.body,s),o+n.transpile((r.body.original||r.body).getText(),a)},t.tryRun=function(e,t,r=[],n){try{return t(...r)}catch(a){throw a instanceof Error?new o(e,(n||"")+a.message):a}},t.macroParamsToArray=function(e,t){const r=[];for(let n=0;n<e.length;n++)e[n].spread?r.push(t.slice(n)):!t[n]&&e[n].defaultVal?r.push(e[n].defaultVal):r.push(t[n]);return r},t.resolveTypeWithTypeParams=function e(t,r,n){const a=t.checker;if("indexType"in t&&"objectType"in t){const i=e(t.indexType,r,n),o=e(t.objectType,r,n),s=i.isTypeParameter()?n[r.findIndex((e=>e===i))]:i;if(!s||!s.isLiteral())return t;const c=o.getProperty(s.value.toString());return c?a.getTypeOfSymbol(c):t}if("checkType"in t&&"extendsType"in t&&"resolvedTrueType"in t&&"resolvedFalseType"in t){const i=e(t.checkType,r,n),o=e(t.extendsType,r,n),s=e(t.resolvedTrueType,r,n),c=e(t.resolvedFalseType,r,n);return a.isTypeAssignableTo(i,o)?s:c}if(t.isIntersection()){const i=new Map;for(const a of t.types){const t=e(a,r,n);for(const e of t.getProperties())i.set(e.name,e)}return a.createAnonymousType(void 0,i,[],[],[])}if(t.isUnion()){const a=Object.assign({},t);return a.types=a.types.map((t=>e(t,r,n))),a}if(t.isTypeParameter())return n[r.findIndex((e=>e===t))]||t;if(t.resolvedTypeArguments){const a=Object.assign({},t);return a.resolvedTypeArguments=t.resolvedTypeArguments.map((t=>e(t,r,n))),a}if(t.getCallSignatures().length){const i=Object.assign({},t),o=t.getCallSignatures()[0],s=Object.assign({},o);return s.resolvedReturnType=e(o.getReturnType(),r,n),s.parameters=s.parameters.map((t=>{if(!t.valueDeclaration||!t.valueDeclaration.type)return t;const i=a.createSymbol(t.flags,t.escapedName);return i.type=e(a.getTypeAtLocation(t.valueDeclaration.type),r,n),i})),i.callSignatures=[s],i}return t},t.resolveTypeArguments=function(e,t){var r;const a=e.getResolvedSignature(t);if(!a||!a.mapper)return[];switch(a.mapper.kind){case n.TypeMapKind.Simple:return[a.mapper.target];case n.TypeMapKind.Array:return(null===(r=a.mapper.targets)||void 0===r?void 0:r.filter((e=>e)))||[];default:return[]}},t.deExpandMacroResults=function(e){const t=[...e],r=t[e.length-1];if(!r)return[e];if(n.isReturnStatement(r)){const r=t.pop().expression;if(!r)return[e];if(n.isCallExpression(r)&&n.isParenthesizedExpression(r.expression)&&n.isArrowFunction(r.expression.expression)){const e=a(r.expression.expression.body);let i=e.pop();return i&&n.isReturnStatement(i)&&i.expression&&(i=i.expression),[[...t,...e],i]}return[t,r]}return[t,t[t.length-1]]},t.normalizeFunctionNode=function(e,t){var r;if(n.isArrowFunction(t)||n.isFunctionExpression(t)||n.isFunctionDeclaration(t))return t;const a=e.getSymbolAtLocation(t);if(a&&(null===(r=a.declarations)||void 0===r?void 0:r.length)){const e=a.declarations[0];if(n.isFunctionLikeDeclaration(e))return e;if(n.isVariableDeclaration(e)&&e.initializer&&n.isFunctionLikeDeclaration(e.initializer))return e.initializer}},t.expressionToStringLiteral=function e(t){return n.isParenthesizedExpression(t)?e(t.expression):n.isStringLiteral(t)?t:n.isIdentifier(t)||n.isNumericLiteral(t)?n.factory.createStringLiteral(t.text):t.kind===n.SyntaxKind.TrueKeyword?n.factory.createStringLiteral("true"):t.kind===n.SyntaxKind.FalseKeyword?n.factory.createStringLiteral("false"):n.factory.createStringLiteral("null")},t.getTypeAtLocation=function(e,t){return-1===t.pos?n.isStringLiteral(t)?e.getStringLiteralType(t.text):n.isNumericLiteral(t)?e.getNumberLiteralType(+t.text):n.isTemplateExpression(t)?e.getStringType():e.getTypeAtLocation(t):e.getTypeAtLocation(t)},t.getGeneralType=function(e,t){return t.isStringLiteral()?e.getStringType():t.isNumberLiteral()?e.getNumberType():i(t.flags,n.TypeFlags.BooleanLiteral)?e.getBooleanType():t};class s extends Map{constructor(){super()}push(e,t){const r=this.get(e);r?r.push(t):this.set(e,[t])}transferKey(e,t){const r=this.deleteAndReturn(e);r&&this.set(t,r)}deleteAndReturn(e){const t=this.get(e);return this.delete(e),t}deleteEntry(e){for(const[,t]of this){const r=t.indexOf(e);-1!==r&&t.splice(r,1)}}clearArray(e){const t=this.get(e);t&&(t.length=0)}}t.MapArray=s},1819:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=1819,e.exports=t},3841:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=3841,e.exports=t},5301:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(6277)}])},6277:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return $}});var n=r(5893),a=r(5423),i=r(3349),o=r(6369),s=r(249);var c='\ndeclare function $$loadEnv(path?: string) : void;\ndeclare function $$readFile(path: string, parseJSON?: false) : string;\ndeclare function $$inline<F extends (...args: any) => any>(func: F, params: Parameters<F>, doNotCall: any) : () => ReturnType<F>;\ndeclare function $$inline<F extends (...args: any) => any>(func: F, params: Parameters<F>) : ReturnType<F>;\ndeclare function $$kindof(ast: unknown) : number;\ndeclare function $$define(varname: string, initializer: unknown, let?: boolean, exportDecl?: boolean) : void;\ndeclare function $$i() : number;\ndeclare function $$length(arr: Array<any>|string) : number;\ndeclare function $$ident(str: string) : any;\ndeclare function $$err(str: string) : void;\ndeclare function $$includes<T>(arr: Array<T>, val: T) : boolean;\ndeclare function $$includes(arr: string, val: string) : boolean;\ndeclare function $$slice<T>(str: Array<T>, start?: number, end?: number) : Array<T>;\ndeclare function $$slice(str: string, start?: number, end?: number) : string;\ndeclare function $$ts<T = unknown>(code: string) : T;\ndeclare function $$escape<T>(code: () => T) : T;\ndeclare function $$typeToString<T>(simplify?: boolean, nonNull?: boolean, fullExpand?: boolean) : string;\ndeclare function $$propsOfType<T>() : Array<string>;\ndeclare function $$typeAssignableTo<T, K>() : boolean;\ndeclare function $$comptime(fn: () => void) : void;\ninterface RawContext {\n    ts: any,\n    factory: any,\n    transformer: any,\n    checker: any,\n    thisMacro: any,\n    error: (node: any, message: string) => void\n}\ndeclare function $$raw<T>(fn: (ctx: RawContext, ...args: any[]) => ts.Node | ts.Node[] | undefined) : T;\ndeclare function $$text(exp: any) : string;\ndeclare function $$decompose(exp: any) : any[];\ndeclare function $$map<T>(exp: T, mapper: (value: any, parent: number) => any) : T;\ntype TypeMetadataJSDocTagCollection = Record<string, string|true>;\ninterface TypeMetadataProperty {\n    name: string,\n    tags: TypeMetadataJSDocTagCollection,\n    type: string,\n    optional: boolean\n}\ninterface TypeMetadataMethod {\n    name: string,\n    tags: TypeMetadataJSDocTagCollection,\n    parameters: Array<{name: string, type: string, optional: boolean}>,\n    returnType: string\n}\ninterface TypeMedatada {\n    name: string,\n    properties: TypeMetadataProperty[],\n    methods: TypeMetadataMethod[]\n}\ndeclare function $$typeMetadata<T>(collectProps?: boolean, collectMethods?: boolean) : TypeMedatada;\ntype Accumulator = number & { __marker?: "Accumulator" };\ntype Save<T> = T & { __marker?: "Save" };\ntype EmptyDecorator = (...props: any) => void;\nconst enum LabelKinds {\n    If,\n    ForIter,\n    For,\n    While,\n    Block\n}\ninterface IfLabel {\n    kind: LabelKinds.If\n    condition: any,\n    then: any,\n    else: any\n}\ninterface ForIterLabel {\n    kind: LabelKinds.ForIter,\n    type: "in" | "of",\n    initializer: any,\n    iterator: any,\n    statement: any\n}\ninterface ForLabel {\n    kind: LabelKinds.For,\n    initializer: {\n        expression?: any,\n        variables?: Array<[variableName: string, initializer: any]>\n    },\n    condition: any,\n    increment: any,\n    statement: any\n}\ninterface WhileLabel {\n    kind: LabelKinds.While,\n    do: boolean,\n    condition: any,\n    statement: any\n}\ninterface BlockLabel {\n    kind: LabelKinds.Block,\n    statement: any\n}\ntype Label = IfLabel | ForIterLabel | ForLabel | WhileLabel | BlockLabel;\n';for(var l in c+="const enum SyntaxKind {\n",Object.keys(a.SyntaxKind))a.SyntaxKind[l]&&(c+="".concat(a.SyntaxKind[l]," = ").concat(l,",\n"));c+="\n}\n";var p={noImplicitAny:!0,strictNullChecks:!0,target:a.ScriptTarget.ESNext,experimentalDecorators:!0,lib:["ES5"]};function u(e){i.macros.clear();var t,r,n,l,u=a.createSourceFile("module.ts",c+e,p.target||a.ScriptTarget.ESNext,!0),f=[],d={getSourceFile:function(e){if("module.ts"===e)return u},getDefaultLibFileName:function(){return"lib.d.ts"},useCaseSensitiveFileNames:function(){return!1},getCanonicalFileName:function(e){return e},writeFile:function(){},getCurrentDirectory:function(){return""},getNewLine:function(){return"\n"},fileExists:function(){return!0},readFile:function(){return""},directoryExists:function(){return!0},getDirectories:function(){return[]}},m=a.createProgram(["module.ts"],p,d);try{m.emit(void 0,(function(e,t){return r=t}),void 0,void 0,{before:[function(e){var r=new s.MacroTransformer(e,m.getTypeChecker(),i.macros);return function(e){var n=r.run(e);return t=(0,o.QM)(m.getTypeChecker(),n),n}}]})}catch(y){n=y,(null!=(l=i.MacroError)&&"undefined"!==typeof Symbol&&l[Symbol.hasInstance]?l[Symbol.hasInstance](n):n instanceof l)&&f.push(y)}return{transpiledSourceCode:r,generatedTypes:{fromMacros:t?t.print(t.typeNodes):"",chainTypes:t?t.print(t.chainTypes):""},errors:f}}var f=r(7294),d=r(9604);function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){var t=(0,d.Ik)(),r=(0,f.useState)(),a=r[0],i=r[1],o=(0,f.useState)(),s=o[0],l=o[1],u=(0,f.useState)(),y=u[0],h=u[1],g="ts:ts-macros/generated_types.d.ts",x="ts:ts-macros/chain_types.d.ts";return(0,f.useEffect)((function(){var r,n;if(t){t.languages.typescript.javascriptDefaults.setCompilerOptions(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){m(e,t,r[t])}))}return e}({},p)),t.languages.typescript.typescriptDefaults.setDiagnosticsOptions({diagnosticCodesToIgnore:[1219]});var a="ts:ts-macros/markers.d.ts";t.languages.typescript.javascriptDefaults.addExtraLib(c,a),t.editor.createModel(c,"typescript",t.Uri.parse(a));var i=(null===(r=e.libCode)||void 0===r?void 0:r.fromMacros)||"";t.languages.typescript.javascriptDefaults.addExtraLib(i,g),l(t.editor.createModel(i,"typescript",t.Uri.parse(g)));var o="export {};\n\n".concat((null===(n=e.libCode)||void 0===n?void 0:n.chainTypes)||"");t.languages.typescript.javascriptDefaults.addExtraLib(o,x),h(t.editor.createModel(o,"typescript",t.Uri.parse(x)))}}),[t]),(0,f.useEffect)((function(){var r,n;t&&(null===s||void 0===s||s.setValue((null===(r=e.libCode)||void 0===r?void 0:r.fromMacros)||""),null===y||void 0===y||y.setValue("export {};\n\n".concat((null===(n=e.libCode)||void 0===n?void 0:n.chainTypes)||"")))}),[e.libCode]),(0,f.useEffect)((function(){if(t&&a){var r=a.getModel();r&&t.editor.setModelMarkers(r,"_",e.errors.map((function(e){var t=r.getPositionAt(e.start),n=r.getPositionAt(e.start+e.length);return{message:e.rawMsg,severity:8,startColumn:t.column,startLineNumber:t.lineNumber,endColumn:n.column,endLineNumber:n.lineNumber}})))}}),[e.errors]),(0,n.jsx)(d.ZP,{height:"calc(90vh - 50px)",language:"typescript",theme:"vs-dark",value:e.code,onChange:e.onChange,onMount:function(e){return i(e)}})}var h,g=r(5884),x=r(8836),v=r.n(x);function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function T(e,t){return null!=t&&"undefined"!==typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);o=!0);}catch(c){s=!0,a=c}finally{try{o||null==r.return||r.return()}finally{if(s)throw a}}return i}}(e,t)||N(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||N(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e,t){if(e){if("string"===typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}function A(e){switch(e){case h.Log:return(0,n.jsxs)("span",{className:v().code,children:["[",(0,n.jsx)("span",{style:{color:"#236cfc",fontWeight:"bold"},children:"LOG"}),"]:"]});case h.Error:return(0,n.jsxs)("span",{className:v().code,children:["[",(0,n.jsx)("span",{style:{color:"#961a1a",fontWeight:"bold"},children:"ERR"}),"]:"]});case h.Warn:return(0,n.jsxs)("span",{className:v().code,children:["[",(0,n.jsx)("span",{style:{color:"orange",fontWeight:"bold"},children:"WARN"}),"]:"]})}}function L(e,t,r,a){return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("span",{className:v().code,children:[(0,n.jsx)("span",{className:v().classNameIdent,children:t.constructor&&t.constructor.name&&"Object"!==t.constructor.name&&t.constructor.name+" "||""}),a||"","{",(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:e.map((function(e,t){var a=b(e,2),i=a[0],o=a[1];return(0,n.jsxs)("span",{children:[!!t&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:v().comma,children:", "}),(0,n.jsx)("br",{})]}),(0,n.jsxs)("span",{children:["  ".repeat(r||2),i,": ",k(o,(r||2)+1)]})]},t)}))}),(0,n.jsx)("br",{}),"  ".repeat(r?r-1:1)+"}"]})})}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("string"===typeof e)return(0,n.jsxs)("span",{className:"".concat(v().code," ").concat(v().string),children:['"',e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),'"']});if("number"===typeof e)return(0,n.jsx)("span",{className:"".concat(v().code," ").concat(v().number),children:e});if("function"===typeof e)return(0,n.jsx)("span",{className:v().code,children:"[Function]"});if(void 0===e)return(0,n.jsx)("span",{className:"".concat(v().code," ").concat(v().keyword),children:"undefined"});if(null===e)return(0,n.jsx)("span",{className:"".concat(v().code," ").concat(v().keyword),children:"null"});if(!0===e)return(0,n.jsx)("span",{className:"".concat(v().code," ").concat(v().keyword),children:"true"});if(!1===e)return(0,n.jsx)("span",{className:"".concat(v().code," ").concat(v().keyword),children:"false"});if(Array.isArray(e))return(0,n.jsxs)("span",{className:v().code,children:["[",e.map((function(e,r){return(0,n.jsxs)("span",{children:[!!r&&(0,n.jsx)("span",{className:v().comma,children:", "}),k(e,t+1)]},r)})),"]"]});if(T(e,Map))return L(E(e.entries()),e,t,"(".concat(e.size,") "));if(T(e,Set))return(0,n.jsxs)("span",{className:v().code,children:[(0,n.jsx)("span",{className:v().classNameIdent,children:"Set "}),"(",e.size,")"," {",E(e.values()).map((function(e,r){return(0,n.jsxs)("span",{children:[!!r&&(0,n.jsx)("span",{className:v().comma,children:", "}),k(e,t+1)]},r)})),"}"]});var r=Object.entries(e);return 0===r.length?(0,n.jsx)(n.Fragment,{children:"{}"}):L(r,e,t)}function w(e){var t=(0,f.useState)([]),r=t[0],a=t[1],i=(0,f.useState)("100%"),o=i[0],s=i[1],c=(0,f.useRef)(null),l=(0,f.useRef)(null),p=function(){c.current&&s("".concat(window.innerHeight-c.current.clientHeight-165,"px"))};(0,f.useEffect)((function(){p(),function(){var e=l.current;e&&(e.scrollTop=e.scrollHeight)}()}),[r]);var u={log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a(E(r).concat(E(t.map((function(e){return{kind:h.Log,message:e}})))))},warn:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a(E(r).concat(E(t.map((function(e){return{kind:h.Warn,message:e}})))))},error:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a(E(r).concat(E(t.map((function(e){return{kind:h.Error,message:e}})))))}};return(0,n.jsxs)(g.Z,{split:"horizontal",defaultSize:"70%",primary:"first",onDragFinished:p,children:[(0,n.jsxs)("div",{style:{width:"100%"},ref:c,children:[(0,n.jsx)(d.ZP,{height:"80vh",language:"javascript",theme:"vs-dark",value:e.code,options:{readOnly:!0}}),";"]}),(0,n.jsxs)("div",{className:v().runSection,children:[(0,n.jsx)("button",{className:v().button,onClick:function(){try{new Function("console",e.code)(u)}catch(t){T(t,Error)&&u.error(t.message)}},children:"Run"}),(0,n.jsx)("button",{className:v().button,onClick:function(){return a([])},children:"Clear"}),(0,n.jsx)("br",{}),(0,n.jsx)("div",{className:v().runSectionResult,style:{height:o},ref:l,children:r.map((function(e,t){return(0,n.jsxs)("div",{children:[!!t&&(0,n.jsx)("div",{className:v().logSeparator}),A(e.kind)," ",k(e.message)]},t)}))})]})]})}!function(e){e[e.Log=0]="Log",e[e.Error=1]="Error",e[e.Warn=2]="Warn"}(h||(h={}));var F=r(6961),M=['function $contains<T>(value: T, possible: Array<T>) {\n    return +["||", [possible], (val: T) => value === val];\n}\n    \nconst searchItem = "google";\nconsole.log($contains!(searchItem, ["erwin", "tj"]));',"function $try(resultObj: Save<{ value?: number, is_err: () => boolean}>) {\n    $$escape!(() => {\n        if (resultObj.is_err()) {\n            return resultObj;\n        }\n    });\n    return resultObj.value;\n}\n\n\nconst a = $try!({ value: 123, is_err: () => false });\nconsole.log(val);",'type ClassInfo = { name: string, value: string };\n\nfunction $makeClasses(...info: Array<ClassInfo>) {\n    +[[info], (classInfo: ClassInfo) => {\n        $$ts!(`\n            class ${classInfo.name} {\n                constructor() {\n                    this.value = ${classInfo.value}\n                }\n            }\n        `);\n    }];\n}\n\n$makeClasses!({name: "A", value: "123"}, {name: "B", value: "345"});','function $map<T, R>(arr: Save<Array<T>>, cb: (item: T) => R) : Array<R> {\n    $$escape!(() => {\n        const res = [];\n        for (let i=0; i < arr.length; i++) {\n        res.push($$inline!(cb, [arr[i]]));\n        }\n    });\n    return $$ident!("res");\n}\n\nconsole.log($map!([1, 2, 3, 4, 5, 6, 7, 8, 9], (num) => num * 2));',"function $ToInterval(info: WhileLabel, intervalTimer = 1000) {\n    const interval = setInterval(() => {\n        if (info.condition) {\n            $$inline!(info.statement, []);\n        } else {\n            clearInterval(interval);\n        }\n    }, intervalTimer);\n}\n\nconst arr = [1, 3, 4, 5, 6];\n\n$ToInterval:\nwhile (arr.length !== 0) {\n    console.log(arr.pop());\n}",'\nfunction $renameClass(newName: string) : EmptyDecorator {\n    return $$raw!((ctx, newNameNode) => {\n       const target = ctx.thisMacro.target;\n       return ctx.factory.createClassDeclaration(\n            target.modifiers?.filter(m => m.kind !== ctx.ts.SyntaxKind.Decorator),\n            ctx.factory.createIdentifier(newNameNode.text),\n            target.typeParameters,\n            target.heritageClauses,\n            target.members\n        )\n    });\n}\n\n@$renameClass!("NewTest")\nclass Test {\n    propA: number\n    propB: string\n    constructor(a: number, b: string) {\n        this.propA = a;\n        this.propB = b;\n    }\n}\n\nconsole.log(new NewTest(1, "hello!"));\n'],C="\n// Interactive playground!\n// Write your code here and see the transpiled result.\n// All types and functions from the library are already imported!\n\n".concat(M[Math.floor(Math.random()*M.length)],"\n");function O(){var e=(0,f.useState)(),t=e[0],r=e[1],a=(0,f.useState)([]),i=a[0],o=a[1],s=(0,f.useState)(),c=s[0],l=s[1],p=(0,f.useState)(),d=p[0],m=p[1],h=function(e){r(e);var t=u(e),n=t.generatedTypes,a=t.errors,i=t.transpiledSourceCode;m(i),l(n),o(a)};return(0,f.useEffect)((function(){var e=Object.fromEntries(new URLSearchParams(window.location.search).entries());if(e.code){var t=(0,F.decompressFromEncodedURIComponent)(e.code);if(!t)return;h(t)}else h(C)}),[]),(0,n.jsxs)("div",{className:v().app,children:[(0,n.jsxs)("header",{className:v().header,children:[(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("h2",{children:"Typescript Macros"}),(0,n.jsx)("button",{className:v().button,onClick:function(){t&&navigator.permissions.query({name:"clipboard-write"}).then((function(e){"granted"!=e.state&&"prompt"!=e.state||navigator.clipboard.writeText(location.origin+location.pathname+"?code=".concat((0,F.compressToEncodedURIComponent)(t)))}))},children:"Copy Link"})]}),(0,n.jsx)("a",{href:"https://github.com/GoogleFeud/ts-macros",style:{fontSize:"24px"},children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"currentColor",viewBox:"0 0 16 16",children:(0,n.jsx)("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})})})]}),(0,n.jsx)("div",{className:v().mainContent,children:(0,n.jsxs)(g.Z,{split:"vertical",defaultSize:"50%",primary:"first",style:{position:"static"},children:[(0,n.jsx)(y,{code:t,libCode:c,errors:i,onChange:function(e){h(e||"")}}),(0,n.jsx)(w,{code:d||""})]})}),(0,n.jsx)("footer",{className:v().footer,children:(0,n.jsxs)("p",{children:["Made with \u2764\ufe0f by ",(0,n.jsx)("a",{href:"https://github.com/GoogleFeud",children:"GoogleFeud"}),"."]})})]})}function $(){return(0,n.jsx)(O,{})}},8836:function(e){e.exports={app:"App_app__8ih7_",header:"App_header__3xFa8",mainContent:"App_mainContent__k7OS5",footer:"App_footer__qJi0F",button:"App_button__Z9okP",runSection:"App_runSection__ptbmi",runSectionResult:"App_runSectionResult__ZpuvE",code:"App_code__SP5sZ",number:"App_number__XeXtQ",string:"App_string__VMgjU",keyword:"App_keyword__MoW95",comma:"App_comma__YKHTd",classNameIdent:"App_classNameIdent__UHLq5",logSeparator:"App_logSeparator__VBwEH",Pane:"App_Pane__XZBvi"}},3411:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=3411,e.exports=t},818:function(){},9939:function(){},175:function(){},4250:function(){},7424:function(){},9107:function(){},444:function(){},6170:function(){},1157:function(){},1638:function(){},9528:function(){},1206:function(){},2183:function(){},3024:function(){},2715:function(){},3611:function(){},8353:function(){},1210:function(){},5573:function(){},3454:function(){}},function(e){e.O(0,[138,21,961,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);